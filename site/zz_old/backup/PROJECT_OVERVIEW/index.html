
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cruxforever.github.com/WRU_ERP/zz_old/backup/PROJECT_OVERVIEW/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Project overview - Wilo-ERP Controlling Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#project-overview" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href="../../.." title="Wilo-ERP Controlling Docs" class="md-header__button md-logo" aria-label="Wilo-ERP Controlling Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Wilo-ERP Controlling Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Project overview
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Поиск">
        
        <button type="reset" class="md-search__icon md-icon" title="Очистить" aria-label="Очистить" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Инициализация поиска
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Вкладки" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Главная

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../00_overview/" class="md-tabs__link">
          
  
  
  Обзор

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../20_process/ACCOUNTING_PRINCIPLES/" class="md-tabs__link">
          
  
  
  Учёт и калькуляция

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../10_data/data_flows/" class="md-tabs__link">
          
  
  
  Данные

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../CODEX_SPEC_Reconcile_Pools_vs_Allocations/" class="md-tabs__link">
          
  
  
  Система ERP

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../40_runbooks/run_budget_year/" class="md-tabs__link">
          
  
  
  Runbooks

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Wilo-ERP Controlling Docs" class="md-nav__button md-logo" aria-label="Wilo-ERP Controlling Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Wilo-ERP Controlling Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Главная
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Обзор
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Обзор
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../00_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    О системе
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ARCHITECTURE_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Архитектура
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../DB_SCHEMA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Схема БД
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ERD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ERD-граф
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Учёт и калькуляция
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Учёт и калькуляция
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../20_process/ACCOUNTING_PRINCIPLES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Принципы учёта
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Структура себестоимости
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Структура себестоимости
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../20_process/COST_STRUCTURE_STATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Обзор
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../20_process/planning/bom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Материальная себестоимость
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../20_process/planning/direct_costs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Прямые затраты (cost_rates)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Данные
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Данные
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../10_data/data_flows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Справочники
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../RULES_COVERAGE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Правила маппинга
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Система ERP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Система ERP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CODEX_SPEC_Reconcile_Pools_vs_Allocations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Переносы затрат
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../IMPLEMENTATION_SUMMARY_2025-10-09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Аллокации и пулы
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Runbooks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Runbooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../40_runbooks/run_budget_year/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Индекс
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../40_runbooks/run_close_period/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Обзор модулей
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#package-calc" class="md-nav__link">
    <span class="md-ellipsis">
      Package calc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Package calc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-calcbudget" class="md-nav__link">
    <span class="md-ellipsis">
      Module calc.budget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-calcefficiency" class="md-nav__link">
    <span class="md-ellipsis">
      Module calc.efficiency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-calcitem_cost" class="md-nav__link">
    <span class="md-ellipsis">
      Module calc.item_cost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-calclogger" class="md-nav__link">
    <span class="md-ellipsis">
      Module calc.logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-calcmaterialize" class="md-nav__link">
    <span class="md-ellipsis">
      Module calc.materialize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-calcpipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Module calc.pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-calcquality" class="md-nav__link">
    <span class="md-ellipsis">
      Module calc.quality
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-calcrates_calc" class="md-nav__link">
    <span class="md-ellipsis">
      Module calc.rates_calc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-calctransfers" class="md-nav__link">
    <span class="md-ellipsis">
      Module calc.transfers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#package-db" class="md-nav__link">
    <span class="md-ellipsis">
      Package db
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Package db">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-dbconnection" class="md-nav__link">
    <span class="md-ellipsis">
      Module db.connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-dbensure_mo" class="md-nav__link">
    <span class="md-ellipsis">
      Module db.ensure_mo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-dbqueries" class="md-nav__link">
    <span class="md-ellipsis">
      Module db.queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-dbschema" class="md-nav__link">
    <span class="md-ellipsis">
      Module db.schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#package-loaders" class="md-nav__link">
    <span class="md-ellipsis">
      Package loaders
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Package loaders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-loadersccg_wru_loader" class="md-nav__link">
    <span class="md-ellipsis">
      Module loaders.ccg_wru_loader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-loadersload_cost_structures" class="md-nav__link">
    <span class="md-ellipsis">
      Module loaders.load_cost_structures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-loadersloader_mo_prices" class="md-nav__link">
    <span class="md-ellipsis">
      Module loaders.loader_mo_prices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-loadersloaders" class="md-nav__link">
    <span class="md-ellipsis">
      Module loaders.loaders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-loadersopex_loader" class="md-nav__link">
    <span class="md-ellipsis">
      Module loaders.opex_loader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-loaderspersonnel_loader" class="md-nav__link">
    <span class="md-ellipsis">
      Module loaders.personnel_loader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-loadersrules_loader" class="md-nav__link">
    <span class="md-ellipsis">
      Module loaders.rules_loader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-loadersupdater" class="md-nav__link">
    <span class="md-ellipsis">
      Module loaders.updater
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-loadersutils" class="md-nav__link">
    <span class="md-ellipsis">
      Module loaders.utils
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#package-app" class="md-nav__link">
    <span class="md-ellipsis">
      Package app
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Package app">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-appapp-import-failed" class="md-nav__link">
    <span class="md-ellipsis">
      Module app.app — import failed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-appinit_db" class="md-nav__link">
    <span class="md-ellipsis">
      Module app.init_db
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#package-ui" class="md-nav__link">
    <span class="md-ellipsis">
      Package ui
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Package ui">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-uiadmin_table_editor" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.admin_table_editor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-uiapp_streamlit" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.app_streamlit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#package-uicomponents" class="md-nav__link">
    <span class="md-ellipsis">
      Package ui.components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-uicomponentsitem_picker" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.components.item_picker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-uicomponentsset_window_title" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.components.set_window_title
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-uiviews_admin" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.views_admin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-uiviews_budget" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.views_budget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-uiviews_bulk_run" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.views_bulk_run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-uiviews_item_cost" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.views_item_cost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-uiviews_mo_loader" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.views_mo_loader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-uiviews_quality" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.views_quality
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-uiviews_rates" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.views_rates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-uiviews_transfers" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.views_transfers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-uiviews_updater" class="md-nav__link">
    <span class="md-ellipsis">
      Module ui.views_updater
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#package-config" class="md-nav__link">
    <span class="md-ellipsis">
      Package config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Package config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-configsettings" class="md-nav__link">
    <span class="md-ellipsis">
      Module config.settings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="project-overview">Project overview<a class="headerlink" href="#project-overview" title="Permanent link">&para;</a></h1>
<h2 id="package-calc">Package <code>calc</code><a class="headerlink" href="#package-calc" title="Permanent link">&para;</a></h2>
<h3 id="module-calcbudget">Module <code>calc.budget</code><a class="headerlink" href="#module-calcbudget" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>build_budget_frames(conn, months_ym: list[str])</code> — Возвращает dict {sheet_name: DataFrame} для Total + помесячных листов.</li>
<li><strong>func</strong> <code>export_budget_to_excel(conn, months_ym: list[str], out_xlsx_path: str)</code> — </li>
<li><strong>func</strong> <code>unit_cost_breakdown(conn, product_id: str) -&gt; dict</code> — </li>
</ul>
<h3 id="module-calcefficiency">Module <code>calc.efficiency</code><a class="headerlink" href="#module-calcefficiency" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>apply_efficiency_normalization(conn, bud_year: 'int', hours_per_person: 'float' = 1972, elem_root: 'str' = 'MFC_PRIM_1', cc_root: 'str' = 'RU1OP1P21', comment: 'str' = 'efficiency normalize', created_by: 'str | None' = None) -&gt; 'str'</code> — </li>
<li><strong>func</strong> <code>compute_efficiency_table(conn, bud_year: 'int', hours_per_person: 'float' = 1972, elem_root: 'str' = 'MFC_PRIM_1', cc_root: 'str' = 'RU1OP1P21') -&gt; 'pd.DataFrame'</code> — Таблица эффективности по производственным ЦЗ:</li>
<li><strong>func</strong> <code>plan_efficiency_normalization(conn, bud_year: 'int', hours_per_person: 'float' = 1972, elem_root: 'str' = 'MFC_PRIM_1', cc_root: 'str' = 'RU1OP1P21') -&gt; 'tuple[pd.DataFrame, pd.DataFrame, pd.DataFrame]'</code> — Строит план нормализации:</li>
</ul>
<h3 id="module-calcitem_cost">Module <code>calc.item_cost</code><a class="headerlink" href="#module-calcitem_cost" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>build_unified_compact_table(conn, product_id: str) -&gt; pandas.core.frame.DataFrame</code> — Компактный вид: суммы по секциям + TOTAL (и доля секции от TOTAL).</li>
<li><strong>func</strong> <code>build_unified_detailed_table(conn, product_id) -&gt; pandas.core.frame.DataFrame</code> — Расширенный вид по правилам контекста:</li>
<li><strong>func</strong> <code>compute_item_cost_unified(conn, product_id)</code> — Собирает компактный вид: строки секций + подитоги по секциям + GRAND.</li>
</ul>
<h3 id="module-calclogger">Module <code>calc.logger</code><a class="headerlink" href="#module-calclogger" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>class</strong> <code>RunLogger(conn, scope: str, params: dict)</code> — </li>
</ul>
<h3 id="module-calcmaterialize">Module <code>calc.materialize</code><a class="headerlink" href="#module-calcmaterialize" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>class</strong> <code>datetime(...)</code> — datetime(year, month, day[, hour[, minute[, second[, microsecond[,tzinfo]]]]])</li>
<li><strong>func</strong> <code>cleanup_routing_tree(conn, product_id: str | None = None)</code> — </li>
<li><strong>func</strong> <code>debug_snapshot(conn, pid: str | None, tag: str)</code> — </li>
<li><strong>func</strong> <code>ensure_depr_opr_cost_tables(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_labor_cost_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_labor_hours_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_ovh_cost_unit_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_routing_flat_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_routing_tree_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_scrap_cost_unit_table(conn)</code> — </li>
<li><strong>func</strong> <code>materialize_depr_costs(conn, product_id: str | None = None)</code> — </li>
<li><strong>func</strong> <code>materialize_flat_bom_recursive(conn, product_id: str | None = None)</code> — </li>
<li><strong>func</strong> <code>materialize_labor_costs(conn, product_id: str | None = None, on_date: str | None = None)</code> — </li>
<li><strong>func</strong> <code>materialize_labor_hours(conn, product_id: str | None = None)</code> — </li>
<li><strong>func</strong> <code>materialize_mo_cost_unit(conn, *, on_date: str | None = None)</code> — Заполняет mo_cost_unit из bom_flat × mo_last_price (на дату или по текущей).</li>
<li><strong>func</strong> <code>materialize_mo_cost_unit_monthly(conn, month_code: str)</code> — Для бюджета: фиксирует цену на месяц (на первый день месяца).</li>
<li><strong>func</strong> <code>materialize_opr_costs(conn, product_id: str | None = None)</code> — </li>
<li><strong>func</strong> <code>materialize_ovh_costs(conn, product_ids=None, year=2026)</code> — АмортизацияОПР  = Σ ( mat_cost_g * depr_opr_share_g )</li>
<li><strong>func</strong> <code>materialize_ovh_flat(conn, product_ids=None)</code> — Строит ovh_flat из ovh_tree, распределяя МАТЕРИАЛЬНУЮ стоимость по alloc_group:</li>
<li><strong>func</strong> <code>materialize_ovh_tree(conn, product_ids=None, max_depth: int = 20)</code> — Строит ovh_tree с протаскиванием alloc_group (ближайшая сверху заданная группа).</li>
<li><strong>func</strong> <code>materialize_routing_flat(conn, product_id: str | None = None)</code> — Заполняет routing_flat на основании routing_tree и routing_operations.</li>
<li><strong>func</strong> <code>materialize_routing_tree(conn, product_id: str | None = None, max_depth: int = 20)</code> — </li>
<li><strong>func</strong> <code>materialize_scrap_cost_unit(conn, product_ids=None, year=2026)</code> — SCRAP = Σ по группам ( mat_cost_group * scrap_share[group] )</li>
<li><strong>func</strong> <code>run_routing_and_labor_pipeline(conn, product_ids=None, *, on_date=None, max_depth=20, clean_before=True)</code> — Единый надёжный пайплайн:</li>
</ul>
<h3 id="module-calcpipeline">Module <code>calc.pipeline</code><a class="headerlink" href="#module-calcpipeline" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>debug_snapshot(conn, pid: str | None, tag: str)</code> — </li>
<li><strong>func</strong> <code>run_full_pipeline(conn, product_ids=None, *, max_depth=20, on_date=None, clean_before=True, dry_run=False) -&gt; str</code> — Массовый расчёт:</li>
<li><strong>func</strong> <code>run_routing_and_labor_pipeline(conn, product_ids=None, *, on_date=None, max_depth=20, clean_before=True)</code> — Единый надёжный пайплайн:</li>
</ul>
<h3 id="module-calcquality">Module <code>calc.quality</code><a class="headerlink" href="#module-calcquality" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>check_bom_components_missing_prices(conn)</code> — Компоненты из BOM без цены в rm_prices (по последней загрузке).</li>
<li><strong>func</strong> <code>check_bom_unknown_items(conn)</code> — BOM с компонентами, отсутствующими в items.</li>
<li><strong>func</strong> <code>check_budget_has_nonproduced(conn)</code> — В prod_budget есть product_id, который в items помечен как is_produced=0.</li>
<li><strong>func</strong> <code>check_items_duplicate_article(conn)</code> — Дубли артикулов (один article на несколько item_id).</li>
<li><strong>func</strong> <code>check_items_nonproduced_has_routing_or_ovh(conn)</code> — Непроизводимые (is_produced=0) с заполненными routing_group/ovh_group_code (подозрительно).</li>
<li><strong>func</strong> <code>check_items_produced_missing_routing_or_ovh(conn)</code> — Производимые (is_produced=1), у которых пусты routing_group или ovh_group_code.</li>
<li><strong>func</strong> <code>check_items_required_fields(conn)</code> — Пустые/нулевые article, name, uom.</li>
<li><strong>func</strong> <code>check_ovh_groups_missing_tariffs(conn, year: 'int | None' = None)</code> — Группы из ovh_flat, которых нет в ovh_tariffs (по году; если год None — берём max(year)).</li>
<li><strong>func</strong> <code>check_routing_flat_missing_rates(conn)</code> — Департаменты из routing_flat без ставки в labor_rates_snapshot.</li>
<li><strong>func</strong> <code>render_quality_ui(conn, st)</code> — Экран проверок с чекбоксами. Пример использования в вашей вьюшке:</li>
<li><strong>func</strong> <code>run_quality_checks(conn, selected: 'list[str] | None' = None) -&gt; 'dict[str, pd.DataFrame]'</code> — selected: список кодов проверок. Если None — запустить все.</li>
</ul>
<h3 id="module-calcrates_calc">Module <code>calc.rates_calc</code><a class="headerlink" href="#module-calcrates_calc" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>class</strong> <code>datetime(...)</code> — datetime(year, month, day[, hour[, minute[, second[, microsecond[,tzinfo]]]]])</li>
<li><strong>func</strong> <code>amounts_by_cc_for_elemgroup(conn, bud_year: int, cc_list: list[str], elem_list: list[str]) -&gt; pandas.core.frame.DataFrame</code> — </li>
<li><strong>func</strong> <code>compare_with_previous(conn, df_current: pandas.core.frame.DataFrame, component_code: str, base_year: int | None = None) -&gt; pandas.core.frame.DataFrame</code> — Если base_year указан и он отличается от текущего bud_year → сравниваем с последним снапшотом base_year.</li>
<li><strong>func</strong> <code>compute_rates(conn, bud_year: int, months_ym: list[str], cc_root: str, kind: str = 'labor') -&gt; pandas.core.frame.DataFrame</code> — Универсальный расчёт ставки = (Сумма по группе элементов) / (Плановые часы) по каждому ЦЗ.</li>
<li><strong>func</strong> <code>fetch_last_snapshot(conn, bud_year: int, component_code: str) -&gt; pandas.core.frame.DataFrame</code> — </li>
<li><strong>func</strong> <code>hours_by_department(conn, months_ym: list[str]) -&gt; pandas.core.frame.DataFrame</code> — Плановые часы по участку за указанные месяцы:</li>
<li><strong>func</strong> <code>save_rates_snapshot(conn, df_rates: pandas.core.frame.DataFrame, kind: str, replace_year: bool = True) -&gt; int</code> — Пишет в таблицу снапшота по kind.</li>
</ul>
<h3 id="module-calctransfers">Module <code>calc.transfers</code><a class="headerlink" href="#module-calctransfers" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>apply_transfer(conn, bud_year: int, rule_id: int, donorshare: float = 1.0, elem_root: str = 'MFC_PRIM_1', recipients_cc: list[str] | None = None, comment: str = '', created_by: str = None) -&gt; str</code> — Создает батч и записывает перенос (только дельты).</li>
<li><strong>func</strong> <code>apply_transfer_by_rules(conn, bud_year: int, elem_root: str = 'MFC_PRIM_1', cc_root: str = 'RU1OP1P21', allow_fallback_global: bool = True, comment: str = '', created_by: str = None) -&gt; str</code> — </li>
<li><strong>func</strong> <code>create_transfer_batch(conn, bud_year: int, rule_id: int, comment: str = '', created_by: str = None) -&gt; str</code> — </li>
<li><strong>func</strong> <code>find_zero_cc(conn, bud_year: int) -&gt; pandas.core.frame.DataFrame</code> — ЦЗ с часами &gt; 0 и нулевым среднегодовым headcount.</li>
<li><strong>func</strong> <code>get_cc_hours(conn, bud_year: int) -&gt; pandas.core.frame.DataFrame</code> — </li>
<li><strong>func</strong> <code>get_opex_by_cc_elem(conn, bud_year: int, elem_root: str = 'MFC_PRIM_1') -&gt; pandas.core.frame.DataFrame</code> — </li>
<li><strong>func</strong> <code>get_opex_by_cc_elem_detailed(conn, bud_year: int, elem_root: str = 'MFC_PRIM_1', cc_root: str = 'RU1OP1P21') -&gt; pandas.core.frame.DataFrame</code> — Суммы OPEX по ЦЗ и КАЖДОМУ elem_id внутри elem_root,</li>
<li><strong>func</strong> <code>get_personnel_year_base(conn, bud_year: int) -&gt; pandas.core.frame.DataFrame</code> — </li>
<li><strong>func</strong> <code>plan_transfer(conn, bud_year: int, rule_id: int, donorshare: float = 1.0, elem_root: str = 'MFC_PRIM_1', recipients_cc: list[str] | None = None) -&gt; tuple[pandas.core.frame.DataFrame, pandas.core.frame.DataFrame]</code> — Возвращает два DF: items_personnel, items_opex.</li>
<li><strong>func</strong> <code>plan_transfer_by_rules(conn, bud_year: int, elem_root: str = 'MFC_PRIM_1', cc_root: str = 'RU1OP1P21', allow_fallback_global: bool = True) -&gt; tuple[pandas.core.frame.DataFrame, pandas.core.frame.DataFrame]</code> — Строит план переносов:</li>
<li><strong>func</strong> <code>revert_transfer(conn, batch_id: str)</code> — Откат: просто удаляем дельты; базовые таблицы не трогаем.</li>
</ul>
<h2 id="package-db">Package <code>db</code><a class="headerlink" href="#package-db" title="Permanent link">&para;</a></h2>
<h3 id="module-dbconnection">Module <code>db.connection</code><a class="headerlink" href="#module-dbconnection" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>class</strong> <code>Path(*args, **kwargs)</code> — PurePath subclass that can make system calls.</li>
<li><strong>func</strong> <code>connect_sqlite(p: str | pathlib.Path) -&gt; sqlite3.Connection</code> — </li>
<li><strong>func</strong> <code>contextmanager(func)</code> — @contextmanager decorator.</li>
<li><strong>func</strong> <code>get_table_info(conn, table: str)</code> — </li>
<li><strong>func</strong> <code>normalize_db_path(raw: str | pathlib.Path) -&gt; pathlib.Path</code> — </li>
</ul>
<h3 id="module-dbensure_mo">Module <code>db.ensure_mo</code><a class="headerlink" href="#module-dbensure_mo" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>ensure_mo_tables(conn)</code> — </li>
</ul>
<h3 id="module-dbqueries">Module <code>db.queries</code><a class="headerlink" href="#module-dbqueries" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>fetch_flat_bom_for_parent(conn, product_id)</code> — </li>
<li><strong>func</strong> <code>fetch_labor_cost_unit(conn, product_id)</code> — </li>
<li><strong>func</strong> <code>fetch_labor_total(conn, product_id) -&gt; float</code> — </li>
<li><strong>func</strong> <code>fetch_materials_from_bom(conn, product_id)</code> — </li>
<li><strong>func</strong> <code>fetch_produced_items(conn)</code> — </li>
<li><strong>func</strong> <code>search_items_by_tokens(conn, tokens: str | list[str], limit_per_token: int = 20) -&gt; pandas.core.frame.DataFrame</code> — Ищет items по множеству токенов (артикул/название/код).</li>
</ul>
<h3 id="module-dbschema">Module <code>db.schema</code><a class="headerlink" href="#module-dbschema" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>add_column_if_missing(conn, table: str, coldef: str)</code> — </li>
<li><strong>func</strong> <code>column_exists(conn, table: str, column: str) -&gt; bool</code> — </li>
<li><strong>func</strong> <code>ensure_bom_struct_stage_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_bom_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_budget_tables(conn)</code> — Создать таблицы для загрузки и хранения бюджета OPEX.</li>
<li><strong>func</strong> <code>ensure_cc_extra_columns(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_depr_opr_cost_tables(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_depr_opr_rates(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_items_columns(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_labor_cost_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_labor_hours_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_labor_rates_snapshot_schema(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_mo_tables(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_ovh_cost_unit_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_ovh_flat_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_ovh_tariffs_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_prod_budget_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_routing_flat_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_routing_tree_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_routings_columns(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_run_logging(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_schema(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_scrap_cost_unit_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_transfers_schema(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_unique_routing_group(conn)</code> — </li>
<li><strong>func</strong> <code>get_table_info(conn, table: str)</code> — </li>
<li><strong>func</strong> <code>table_exists(conn, name: str) -&gt; bool</code> — </li>
</ul>
<h2 id="package-loaders">Package <code>loaders</code><a class="headerlink" href="#package-loaders" title="Permanent link">&para;</a></h2>
<h3 id="module-loadersccg_wru_loader">Module <code>loaders.ccg_wru_loader</code><a class="headerlink" href="#module-loadersccg_wru_loader" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>class</strong> <code>Any(*args, **kwargs)</code> — Special type indicating an unconstrained type.</li>
<li><strong>func</strong> <code>ensure_cc_extra_columns(conn)</code> — </li>
<li><strong>func</strong> <code>load_cc_structure_twofiles(conn: 'sqlite3.Connection', groups_path: 'str', leaves_path: 'str', sheet_name: 'str | None' = None)</code> — </li>
<li><strong>func</strong> <code>parse_groups_from_ccg(df: 'pd.DataFrame') -&gt; 'Tuple[List[Dict], List[Tuple[str, str]]]'</code> — </li>
<li><strong>func</strong> <code>parse_leaves_from_list(df: 'pd.DataFrame') -&gt; 'Tuple[List[Dict], List[Tuple[str, str]]]'</code> — </li>
<li><strong>func</strong> <code>upsert_cc(conn: 'sqlite3.Connection', nodes: 'List[Dict]', edges: 'List[Tuple[str, str]]')</code> — </li>
</ul>
<h3 id="module-loadersload_cost_structures">Module <code>loaders.load_cost_structures</code><a class="headerlink" href="#module-loadersload_cost_structures" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>class</strong> <code>Any(*args, **kwargs)</code> — Special type indicating an unconstrained type.</li>
<li><strong>func</strong> <code>cc_duplicates_report(conn: sqlite3.Connection) -&gt; Dict[str, pandas.core.frame.DataFrame]</code> — Возвращает диагностические DataFrame:</li>
<li><strong>func</strong> <code>ensure_schema(conn: sqlite3.Connection) -&gt; None</code> — </li>
<li><strong>func</strong> <code>main()</code> — </li>
<li><strong>func</strong> <code>parse_ccg(df: pandas.core.frame.DataFrame) -&gt; Tuple[List[Dict], List[Tuple[str, str]]]</code> — Разбор CCG WRU с поддержкой разных имён колонок уровней (Level0/LEVEL 1/L2/Уровень 3 и т.д.).</li>
<li><strong>func</strong> <code>parse_mfc(df: pandas.core.frame.DataFrame, leaf_level: int = 5) -&gt; Tuple[List[Dict], List[Tuple[str, str]]]</code> — Скольжение по дереву MFCPRIM:</li>
<li><strong>func</strong> <code>quality_checks(conn: sqlite3.Connection) -&gt; Dict[str, int]</code> — </li>
<li><strong>func</strong> <code>upsert_cc(conn: sqlite3.Connection, nodes: List[Dict], edges: List[Tuple[str, str]]) -&gt; None</code> — </li>
<li><strong>func</strong> <code>upsert_elem(conn, nodes, edges)</code> — </li>
</ul>
<h3 id="module-loadersloader_mo_prices">Module <code>loaders.loader_mo_prices</code><a class="headerlink" href="#module-loadersloader_mo_prices" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>class</strong> <code>datetime(...)</code> — datetime(year, month, day[, hour[, minute[, second[, microsecond[,tzinfo]]]]])</li>
<li><strong>func</strong> <code>load_mo_prices(path: str, conn, *, sheet_name: int | str = 0, vendor: Optional[str] = None, effective_from: Optional[str] = None, effective_to: Optional[str] = None, source: Optional[str] = None, preview_only: bool = True)</code> — </li>
</ul>
<h3 id="module-loadersloaders">Module <code>loaders.loaders</code><a class="headerlink" href="#module-loadersloaders" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>class</strong> <code>Decimal(value='0', context=None)</code> — Construct a new Decimal object. 'value' can be an integer, string, tuple,</li>
<li><strong>class</strong> <code>InvalidOperation(...)</code> — Base class for arithmetic errors.</li>
<li><strong>func</strong> <code>apply_department_suggestions(conn, df_suggestions)</code> — Применяет suggested_dept к операциям с UNASSIGNED/пустым департаментом.</li>
<li><strong>func</strong> <code>diagnose_routings(conn)</code> — Возвращает словарь DataFrame'ов:</li>
<li><strong>func</strong> <code>ensure_bom_struct_stage_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_items_columns(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_ovh_tariffs_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_prod_budget_table(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_routings_columns(conn)</code> — </li>
<li><strong>func</strong> <code>load_ovh_tariffs_from_xlsx(conn, xlsx_path: 'str', year: 'int')</code> — Ожидается 5 колонок:</li>
<li><strong>func</strong> <code>load_prod_budget_from_xlsx(conn, xlsx_path: 'str', article_aliases=None, name_aliases=None)</code> — Двухстрочный заголовок: склеиваем header=[0,1].</li>
<li><strong>func</strong> <code>normalize_department_code(dept_raw, operation_text: 'str')</code> — Возвращает (dept_code, source), где source ∈ {"given","inferred","default"}.</li>
<li><strong>func</strong> <code>safe_col(df: pandas.core.frame.DataFrame, name: str, default=None)</code> — </li>
<li><strong>func</strong> <code>split_work_type(row) -&gt; 'pd.Series'</code> — Из "Вид работ" пытается извлечь operation и department.</li>
<li><strong>func</strong> <code>sync_bom_struct_from_stage(conn, spec_codes: 'list[str] | None' = None)</code> — </li>
<li><strong>func</strong> <code>to_float_ru(x)</code> — </li>
<li><strong>func</strong> <code>upsert_bom_general(conn, df: 'pd.DataFrame', allow_stub_items: 'bool' = False)</code> — </li>
<li><strong>func</strong> <code>upsert_bom_struct(conn, df: 'pd.DataFrame', *, default_qty_if_blank: 'float' = 1.0, create_stub_items: 'bool' = True, source_batch: 'str | None' = None)</code> — </li>
<li><strong>func</strong> <code>upsert_depr_rates_snapshot(conn, df: 'pd.DataFrame', default_year: 'int | None' = None, source: 'str' = 'file')</code> — </li>
<li><strong>func</strong> <code>upsert_items(conn, df: 'pd.DataFrame')</code> — </li>
<li><strong>func</strong> <code>upsert_labor_rates_periodic(conn, df: 'pd.DataFrame')</code> — </li>
<li><strong>func</strong> <code>upsert_labor_rates_snapshot(conn, df: 'pd.DataFrame', default_year: 'int | None' = None, source: 'str' = 'file')</code> — </li>
<li><strong>func</strong> <code>upsert_opr_rates_snapshot(conn, df: 'pd.DataFrame', default_year: 'int | None' = None, source: 'str' = 'file')</code> — </li>
<li><strong>func</strong> <code>upsert_rm_prices(conn, df: 'pd.DataFrame', filename: 'str')</code> — </li>
<li><strong>func</strong> <code>upsert_routings(conn, df: 'pd.DataFrame')</code> — Единый routing на один routing_group.</li>
</ul>
<h3 id="module-loadersopex_loader">Module <code>loaders.opex_loader</code><a class="headerlink" href="#module-loadersopex_loader" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>commit_opex(conn: sqlite3.Connection, load_id: str, bud_year: int = 2026) -&gt; tuple[int, float]</code> — </li>
<li><strong>func</strong> <code>diagnose_opex_stage(conn, load_id: str) -&gt; dict</code> — </li>
<li><strong>func</strong> <code>read_opex_excel(path: str, sheet_name: str = 'INPUT') -&gt; pandas.core.frame.DataFrame</code> — </li>
<li><strong>func</strong> <code>stage_opex(conn, df: pandas.core.frame.DataFrame, sheet_name: str, treat_empty_as_zero: bool = False)</code> — </li>
</ul>
<h3 id="module-loaderspersonnel_loader">Module <code>loaders.personnel_loader</code><a class="headerlink" href="#module-loaderspersonnel_loader" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>class</strong> <code>BinaryIO()</code> — Typed version of the return of open() in binary mode.</li>
<li><strong>func</strong> <code>load_personnel_monthly_from_excel(conn, xls: 'ExcelInput', bud_year: 'int', sheet: 'Optional[str]' = None, clear_year_first: 'bool' = False, source: 'str' = 'file', note: 'str' = None) -&gt; 'tuple[int, pd.DataFrame]'</code> — Загружает персонал по месяцам (personnel_monthly) из xlsx формата как в 110_HC_2026.xlsx.</li>
</ul>
<h3 id="module-loadersrules_loader">Module <code>loaders.rules_loader</code><a class="headerlink" href="#module-loadersrules_loader" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>ensure_rules_schema(conn: 'sqlite3.Connection') -&gt; 'None'</code> — </li>
<li><strong>func</strong> <code>list_rules(conn: 'sqlite3.Connection', q: 'Optional[str]' = None, limit: 'int' = 500) -&gt; 'pd.DataFrame'</code> — </li>
<li><strong>func</strong> <code>read_rules_excel(xlsx_path: 'str') -&gt; 'Tuple[pd.DataFrame, pd.DataFrame]'</code> — Читает оба листа из файла: detail_rules и fallback_rules (если есть).</li>
<li><strong>func</strong> <code>toggle_rule(conn: 'sqlite3.Connection', rule_id: 'int', enabled: 'bool') -&gt; 'None'</code> — </li>
<li><strong>func</strong> <code>update_rule_row(conn: 'sqlite3.Connection', row: 'Dict') -&gt; 'None'</code> — </li>
<li><strong>func</strong> <code>upsert_rules(conn: 'sqlite3.Connection', df_rules: 'pd.DataFrame', enable: 'bool' = True) -&gt; 'int'</code> — Массовая запись правил. Если правило с теми же (priority, cost_type, pattern, elem_id) уже есть —</li>
<li><strong>func</strong> <code>validate_rules(conn: 'sqlite3.Connection', df_rules: 'pd.DataFrame') -&gt; 'pd.DataFrame'</code> — Проверка: elem_id существует в elem_nodes; предупреждения по пустым cost_type и pattern одновременно.</li>
</ul>
<h3 id="module-loadersupdater">Module <code>loaders.updater</code><a class="headerlink" href="#module-loadersupdater" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>class</strong> <code>datetime(...)</code> — datetime(year, month, day[, hour[, minute[, second[, microsecond[,tzinfo]]]]])</li>
<li><strong>func</strong> <code>apply_items_updates(conn, preview_df: 'pd.DataFrame') -&gt; 'int'</code> — Принимает датафрейм из preview_items_updates; применяет UPDATE только по изменённым полям.</li>
<li><strong>func</strong> <code>apply_std_prices(conn, preview_df: 'pd.DataFrame', source_name: 'str') -&gt; 'int'</code> — Принимаем датафрейм из preview_std_prices (можно отфильтровать note IS NULL),</li>
<li><strong>func</strong> <code>preview_items_updates(conn, excel_bytes: 'bytes', sheet: 'str | int' = 0) -&gt; 'pd.DataFrame'</code> — </li>
<li><strong>func</strong> <code>preview_std_prices(conn, excel_bytes: 'bytes', sheet: 'str | int' = 0, article_col='Material', price_col='STD 2026', uom='ШТ', currency='RUB') -&gt; 'pd.DataFrame'</code> — </li>
</ul>
<h3 id="module-loadersutils">Module <code>loaders.utils</code><a class="headerlink" href="#module-loadersutils" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>drop_1c_totals(df: pandas.core.frame.DataFrame) -&gt; pandas.core.frame.DataFrame</code> — </li>
<li><strong>func</strong> <code>read_1c_txt(file_bytes: bytes, encoding='auto') -&gt; pandas.core.frame.DataFrame</code> — </li>
<li><strong>func</strong> <code>read_excel(file_bytes: bytes) -&gt; pandas.core.frame.DataFrame</code> — </li>
<li><strong>func</strong> <code>safe_col(df: pandas.core.frame.DataFrame, name: str, default=None)</code> — </li>
<li><strong>func</strong> <code>to_float_ru(x)</code> — </li>
</ul>
<h2 id="package-app">Package <code>app</code><a class="headerlink" href="#package-app" title="Permanent link">&para;</a></h2>
<h3 id="module-appapp-import-failed">Module <code>app.app</code> — <em>import failed</em><a class="headerlink" href="#module-appapp-import-failed" title="Permanent link">&para;</a></h3>
<h3 id="module-appinit_db">Module <code>app.init_db</code><a class="headerlink" href="#module-appinit_db" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>class</strong> <code>Path(*args, **kwargs)</code> — PurePath subclass that can make system calls.</li>
<li><strong>func</strong> <code>main()</code> — </li>
</ul>
<h2 id="package-ui">Package <code>ui</code><a class="headerlink" href="#package-ui" title="Permanent link">&para;</a></h2>
<h3 id="module-uiadmin_table_editor">Module <code>ui.admin_table_editor</code><a class="headerlink" href="#module-uiadmin_table_editor" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>render_table_editor(conn: sqlite3.Connection)</code> — </li>
</ul>
<h3 id="module-uiapp_streamlit">Module <code>ui.app_streamlit</code><a class="headerlink" href="#module-uiapp_streamlit" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>connect_sqlite(p: str | pathlib.Path) -&gt; sqlite3.Connection</code> — </li>
<li><strong>func</strong> <code>ensure_schema(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_unique_routing_group(conn)</code> — </li>
<li><strong>func</strong> <code>main()</code> — </li>
<li><strong>func</strong> <code>normalize_db_path(raw: str | pathlib.Path) -&gt; pathlib.Path</code> — </li>
<li><strong>func</strong> <code>render_admin(db_path: str, encoding='auto')</code> — </li>
<li><strong>func</strong> <code>render_budget_run(db_path: str)</code> — </li>
<li><strong>func</strong> <code>render_bulk_run(db_path: str)</code> — </li>
<li><strong>func</strong> <code>render_item_cost(db_path: str)</code> — </li>
<li><strong>func</strong> <code>render_updater(db_path: str)</code> — </li>
<li><strong>func</strong> <code>run_nsi_refs()</code> — </li>
</ul>
<h3 id="package-uicomponents">Package <code>ui.components</code><a class="headerlink" href="#package-uicomponents" title="Permanent link">&para;</a></h3>
<h3 id="module-uicomponentsitem_picker">Module <code>ui.components.item_picker</code><a class="headerlink" href="#module-uicomponentsitem_picker" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>connect_sqlite(p: str | pathlib.Path) -&gt; sqlite3.Connection</code> — </li>
<li><strong>func</strong> <code>item_paste_picker(db_path: str, key_prefix: str = 'picker', title: str = 'Выбор позиций для расчёта') -&gt; List[str]</code> — Возвращает список выбранных item_id.</li>
<li><strong>func</strong> <code>search_items_by_tokens(conn, tokens: str | list[str], limit_per_token: int = 20) -&gt; pandas.core.frame.DataFrame</code> — Ищет items по множеству токенов (артикул/название/код).</li>
</ul>
<h3 id="module-uicomponentsset_window_title">Module <code>ui.components.set_window_title</code><a class="headerlink" href="#module-uicomponentsset_window_title" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>set_window_title(title: str)</code> — </li>
</ul>
<h3 id="module-uiviews_admin">Module <code>ui.views_admin</code><a class="headerlink" href="#module-uiviews_admin" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>connect_sqlite(p: str | pathlib.Path) -&gt; sqlite3.Connection</code> — </li>
<li><strong>func</strong> <code>ensure_mo_tables(conn)</code> — </li>
<li><strong>func</strong> <code>ensure_schema(conn)</code> — </li>
<li><strong>func</strong> <code>load_mo_prices(path: str, conn, *, sheet_name: int | str = 0, vendor: Optional[str] = None, effective_from: Optional[str] = None, effective_to: Optional[str] = None, source: Optional[str] = None, preview_only: bool = True)</code> — </li>
<li><strong>func</strong> <code>materialize_mo_cost_unit(conn, *, on_date: str | None = None)</code> — Заполняет mo_cost_unit из bom_flat × mo_last_price (на дату или по текущей).</li>
<li><strong>func</strong> <code>read_1c_txt(file_bytes: bytes, encoding='auto') -&gt; pandas.core.frame.DataFrame</code> — </li>
<li><strong>func</strong> <code>read_excel(file_bytes: bytes) -&gt; pandas.core.frame.DataFrame</code> — </li>
<li><strong>func</strong> <code>render(db_path: str, encoding='auto')</code> — </li>
<li><strong>func</strong> <code>sync_bom_struct_from_stage(conn, spec_codes: 'list[str] | None' = None)</code> — </li>
<li><strong>func</strong> <code>upsert_bom_general(conn, df: 'pd.DataFrame', allow_stub_items: 'bool' = False)</code> — </li>
<li><strong>func</strong> <code>upsert_bom_struct(conn, df: 'pd.DataFrame', *, default_qty_if_blank: 'float' = 1.0, create_stub_items: 'bool' = True, source_batch: 'str | None' = None)</code> — </li>
<li><strong>func</strong> <code>upsert_depr_rates_snapshot(conn, df: 'pd.DataFrame', default_year: 'int | None' = None, source: 'str' = 'file')</code> — </li>
<li><strong>func</strong> <code>upsert_items(conn, df: 'pd.DataFrame')</code> — </li>
<li><strong>func</strong> <code>upsert_labor_rates_snapshot(conn, df: 'pd.DataFrame', default_year: 'int | None' = None, source: 'str' = 'file')</code> — </li>
<li><strong>func</strong> <code>upsert_opr_rates_snapshot(conn, df: 'pd.DataFrame', default_year: 'int | None' = None, source: 'str' = 'file')</code> — </li>
<li><strong>func</strong> <code>upsert_rm_prices(conn, df: 'pd.DataFrame', filename: 'str')</code> — </li>
<li><strong>func</strong> <code>upsert_routings(conn, df: 'pd.DataFrame')</code> — Единый routing на один routing_group.</li>
</ul>
<h3 id="module-uiviews_budget">Module <code>ui.views_budget</code><a class="headerlink" href="#module-uiviews_budget" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>connect_sqlite(p: str | pathlib.Path) -&gt; sqlite3.Connection</code> — </li>
<li><strong>func</strong> <code>ensure_schema(conn)</code> — </li>
<li><strong>func</strong> <code>load_prod_budget_from_xlsx(conn, xlsx_path: 'str', article_aliases=None, name_aliases=None)</code> — Двухстрочный заголовок: склеиваем header=[0,1].</li>
<li><strong>func</strong> <code>normalize_db_path(raw: str | pathlib.Path) -&gt; pathlib.Path</code> — </li>
<li><strong>func</strong> <code>render_budget_run(db_path: str)</code> — </li>
<li><strong>func</strong> <code>render_rates_calc(conn: sqlite3.Connection)</code> — </li>
<li><strong>func</strong> <code>render_transfers(conn)</code> — </li>
</ul>
<h3 id="module-uiviews_bulk_run">Module <code>ui.views_bulk_run</code><a class="headerlink" href="#module-uiviews_bulk_run" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>connect_sqlite(p: str | pathlib.Path) -&gt; sqlite3.Connection</code> — </li>
<li><strong>func</strong> <code>ensure_schema(conn)</code> — </li>
<li><strong>func</strong> <code>item_paste_picker(db_path: str, key_prefix: str = 'picker', title: str = 'Выбор позиций для расчёта') -&gt; List[str]</code> — Возвращает список выбранных item_id.</li>
<li><strong>func</strong> <code>render(db_path: str)</code> — </li>
</ul>
<h3 id="module-uiviews_item_cost">Module <code>ui.views_item_cost</code><a class="headerlink" href="#module-uiviews_item_cost" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>build_unified_compact_table(conn, product_id: str) -&gt; pandas.core.frame.DataFrame</code> — Компактный вид: суммы по секциям + TOTAL (и доля секции от TOTAL).</li>
<li><strong>func</strong> <code>build_unified_detailed_table(conn, product_id) -&gt; pandas.core.frame.DataFrame</code> — Расширенный вид по правилам контекста:</li>
<li><strong>func</strong> <code>compute_item_cost_unified(conn, product_id)</code> — Собирает компактный вид: строки секций + подитоги по секциям + GRAND.</li>
<li><strong>func</strong> <code>connect_sqlite(p: str | pathlib.Path) -&gt; sqlite3.Connection</code> — </li>
<li><strong>func</strong> <code>item_paste_picker(db_path: str, key_prefix: str = 'picker', title: str = 'Выбор позиций для расчёта') -&gt; List[str]</code> — Возвращает список выбранных item_id.</li>
<li><strong>func</strong> <code>render(db_path: str)</code> — </li>
</ul>
<h3 id="module-uiviews_mo_loader">Module <code>ui.views_mo_loader</code><a class="headerlink" href="#module-uiviews_mo_loader" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>load_mo_prices(path: str, conn, *, sheet_name: int | str = 0, vendor: Optional[str] = None, effective_from: Optional[str] = None, effective_to: Optional[str] = None, source: Optional[str] = None, preview_only: bool = True)</code> — </li>
<li><strong>func</strong> <code>view_mo_loader(conn)</code> — </li>
</ul>
<h3 id="module-uiviews_quality">Module <code>ui.views_quality</code><a class="headerlink" href="#module-uiviews_quality" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>check_bom_components_missing_prices(conn)</code> — Компоненты из BOM без цены в rm_prices (по последней загрузке).</li>
<li><strong>func</strong> <code>check_bom_unknown_items(conn)</code> — BOM с компонентами, отсутствующими в items.</li>
<li><strong>func</strong> <code>check_budget_has_nonproduced(conn)</code> — В prod_budget есть product_id, который в items помечен как is_produced=0.</li>
<li><strong>func</strong> <code>check_items_duplicate_article(conn)</code> — Дубли артикулов (один article на несколько item_id).</li>
<li><strong>func</strong> <code>check_items_nonproduced_has_routing_or_ovh(conn)</code> — Непроизводимые (is_produced=0) с заполненными routing_group/ovh_group_code (подозрительно).</li>
<li><strong>func</strong> <code>check_items_produced_missing_routing_or_ovh(conn)</code> — Производимые (is_produced=1), у которых пусты routing_group или ovh_group_code.</li>
<li><strong>func</strong> <code>check_items_required_fields(conn)</code> — Пустые/нулевые article, name, uom.</li>
<li><strong>func</strong> <code>check_ovh_groups_missing_tariffs(conn, year: 'int | None' = None)</code> — Группы из ovh_flat, которых нет в ovh_tariffs (по году; если год None — берём max(year)).</li>
<li><strong>func</strong> <code>check_routing_flat_missing_rates(conn)</code> — Департаменты из routing_flat без ставки в labor_rates_snapshot.</li>
<li><strong>func</strong> <code>connect_sqlite(p: str | pathlib.Path) -&gt; sqlite3.Connection</code> — </li>
<li><strong>func</strong> <code>ensure_schema(conn)</code> — </li>
<li><strong>func</strong> <code>render(db_path: str)</code> — </li>
</ul>
<h3 id="module-uiviews_rates">Module <code>ui.views_rates</code><a class="headerlink" href="#module-uiviews_rates" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>compare_with_previous(conn, df_current: pandas.core.frame.DataFrame, component_code: str, base_year: int | None = None) -&gt; pandas.core.frame.DataFrame</code> — Если base_year указан и он отличается от текущего bud_year → сравниваем с последним снапшотом base_year.</li>
<li><strong>func</strong> <code>compute_rates(conn, bud_year: int, months_ym: list[str], cc_root: str, kind: str = 'labor') -&gt; pandas.core.frame.DataFrame</code> — Универсальный расчёт ставки = (Сумма по группе элементов) / (Плановые часы) по каждому ЦЗ.</li>
<li><strong>func</strong> <code>fetch_last_snapshot(conn, bud_year: int, component_code: str) -&gt; pandas.core.frame.DataFrame</code> — </li>
<li><strong>func</strong> <code>render_rates_calc(conn: sqlite3.Connection)</code> — </li>
<li><strong>func</strong> <code>save_rates_snapshot(conn, df_rates: pandas.core.frame.DataFrame, kind: str, replace_year: bool = True) -&gt; int</code> — Пишет в таблицу снапшота по kind.</li>
</ul>
<h3 id="module-uiviews_transfers">Module <code>ui.views_transfers</code><a class="headerlink" href="#module-uiviews_transfers" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>apply_efficiency_normalization(conn, bud_year: 'int', hours_per_person: 'float' = 1972, elem_root: 'str' = 'MFC_PRIM_1', cc_root: 'str' = 'RU1OP1P21', comment: 'str' = 'efficiency normalize', created_by: 'str | None' = None) -&gt; 'str'</code> — </li>
<li><strong>func</strong> <code>apply_transfer_by_rules(conn, bud_year: int, elem_root: str = 'MFC_PRIM_1', cc_root: str = 'RU1OP1P21', allow_fallback_global: bool = True, comment: str = '', created_by: str = None) -&gt; str</code> — </li>
<li><strong>func</strong> <code>compute_efficiency_table(conn, bud_year: 'int', hours_per_person: 'float' = 1972, elem_root: 'str' = 'MFC_PRIM_1', cc_root: 'str' = 'RU1OP1P21') -&gt; 'pd.DataFrame'</code> — Таблица эффективности по производственным ЦЗ:</li>
<li><strong>func</strong> <code>ensure_transfers_schema(conn)</code> — </li>
<li><strong>func</strong> <code>load_personnel_monthly_from_excel(conn, xls: 'ExcelInput', bud_year: 'int', sheet: 'Optional[str]' = None, clear_year_first: 'bool' = False, source: 'str' = 'file', note: 'str' = None) -&gt; 'tuple[int, pd.DataFrame]'</code> — Загружает персонал по месяцам (personnel_monthly) из xlsx формата как в 110_HC_2026.xlsx.</li>
<li><strong>func</strong> <code>plan_efficiency_normalization(conn, bud_year: 'int', hours_per_person: 'float' = 1972, elem_root: 'str' = 'MFC_PRIM_1', cc_root: 'str' = 'RU1OP1P21') -&gt; 'tuple[pd.DataFrame, pd.DataFrame, pd.DataFrame]'</code> — Строит план нормализации:</li>
<li><strong>func</strong> <code>plan_transfer_by_rules(conn, bud_year: int, elem_root: str = 'MFC_PRIM_1', cc_root: str = 'RU1OP1P21', allow_fallback_global: bool = True) -&gt; tuple[pandas.core.frame.DataFrame, pandas.core.frame.DataFrame]</code> — Строит план переносов:</li>
<li><strong>func</strong> <code>render_transfers(conn)</code> — </li>
<li><strong>func</strong> <code>revert_transfer(conn, batch_id: str)</code> — Откат: просто удаляем дельты; базовые таблицы не трогаем.</li>
</ul>
<h3 id="module-uiviews_updater">Module <code>ui.views_updater</code><a class="headerlink" href="#module-uiviews_updater" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>func</strong> <code>apply_items_updates(conn, preview_df: 'pd.DataFrame') -&gt; 'int'</code> — Принимает датафрейм из preview_items_updates; применяет UPDATE только по изменённым полям.</li>
<li><strong>func</strong> <code>apply_std_prices(conn, preview_df: 'pd.DataFrame', source_name: 'str') -&gt; 'int'</code> — Принимаем датафрейм из preview_std_prices (можно отфильтровать note IS NULL),</li>
<li><strong>func</strong> <code>connect_sqlite(p: str | pathlib.Path) -&gt; sqlite3.Connection</code> — </li>
<li><strong>func</strong> <code>ensure_schema(conn)</code> — </li>
<li><strong>func</strong> <code>preview_items_updates(conn, excel_bytes: 'bytes', sheet: 'str | int' = 0) -&gt; 'pd.DataFrame'</code> — </li>
<li><strong>func</strong> <code>preview_std_prices(conn, excel_bytes: 'bytes', sheet: 'str | int' = 0, article_col='Material', price_col='STD 2026', uom='ШТ', currency='RUB') -&gt; 'pd.DataFrame'</code> — </li>
<li><strong>func</strong> <code>render(db_path: str)</code> — </li>
</ul>
<h2 id="package-config">Package <code>config</code><a class="headerlink" href="#package-config" title="Permanent link">&para;</a></h2>
<h3 id="module-configsettings">Module <code>config.settings</code><a class="headerlink" href="#module-configsettings" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>class</strong> <code>Path(*args, **kwargs)</code> — PurePath subclass that can make system calls.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.instant", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.9.0/dist/mermaid.min.js"></script>
      
        <script src="../../../js/init_mermaid.js"></script>
      
    
  </body>
</html>