
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cruxforever.github.com/WRU_ERP/zz_old/DB_SCHEMA/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>DB_SCHEMA - Wilo-ERP Controlling Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#db_schema" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href="../.." title="Wilo-ERP Controlling Docs" class="md-header__button md-logo" aria-label="Wilo-ERP Controlling Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Wilo-ERP Controlling Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              DB_SCHEMA
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Поиск">
        
        <button type="reset" class="md-search__icon md-icon" title="Очистить" aria-label="Очистить" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Инициализация поиска
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Вкладки" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Главная

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../00_overview/" class="md-tabs__link">
          
  
  
  Обзор

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../20_process/ACCOUNTING_PRINCIPLES/" class="md-tabs__link">
          
  
  
  Учёт и калькуляция

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../10_data/data_flows/" class="md-tabs__link">
          
  
  
  Данные

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../backup/CODEX_SPEC_Reconcile_Pools_vs_Allocations/" class="md-tabs__link">
          
  
  
  Система ERP

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../40_runbooks/run_budget_year/" class="md-tabs__link">
          
  
  
  Runbooks

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Wilo-ERP Controlling Docs" class="md-nav__button md-logo" aria-label="Wilo-ERP Controlling Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Wilo-ERP Controlling Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Главная
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Обзор
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Обзор
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    О системе
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ARCHITECTURE_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Архитектура
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB_SCHEMA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Схема БД
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ERD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ERD-граф
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Учёт и калькуляция
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Учёт и калькуляция
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../20_process/ACCOUNTING_PRINCIPLES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Принципы учёта
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Структура себестоимости
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Структура себестоимости
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../20_process/COST_STRUCTURE_STATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Обзор
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../20_process/planning/bom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Материальная себестоимость
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../20_process/planning/direct_costs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Прямые затраты (cost_rates)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Данные
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Данные
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10_data/data_flows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Справочники
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RULES_COVERAGE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Правила маппинга
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Система ERP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Система ERP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backup/CODEX_SPEC_Reconcile_Pools_vs_Allocations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Переносы затрат
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../IMPLEMENTATION_SUMMARY_2025-10-09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Аллокации и пулы
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Runbooks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Runbooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../40_runbooks/run_budget_year/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Индекс
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../40_runbooks/run_close_period/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Обзор модулей
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objects" class="md-nav__link">
    <span class="md-ellipsis">
      Objects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-active_alloc_sets" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: active_alloc_sets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-active_periods" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: active_periods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-active_scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: active_scenarios
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-activity_to_routing" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: activity_to_routing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-bom" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: bom
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-bom_spec_components" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: bom_spec_components
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-bom_specs" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: bom_specs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-bom_specs_new" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: bom_specs_new
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-commodity_map" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: commodity_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-cost_allocations" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: cost_allocations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-cost_rates" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: cost_rates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-dep_cc_map" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: dep_cc_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-depr_rates_snapshot" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: depr_rates_snapshot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-driver_sets" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: driver_sets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-driver_values" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: driver_values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-drivers" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: drivers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-elem_to_ovh" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: elem_to_ovh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-fact_measures" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: fact_measures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-item_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: item_nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-items" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: items
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-lineage_links" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: lineage_links
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-mfc_cc_set_items" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: mfc_cc_set_items
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-mfc_cc_sets" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: mfc_cc_sets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-mfc_elem_set_items" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: mfc_elem_set_items
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-mfc_elem_sets" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: mfc_elem_sets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-mfc_report_defs" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: mfc_report_defs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-mfc_report_line_rules" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: mfc_report_line_rules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-mfc_report_lines" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: mfc_report_lines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-mo_catalog" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: mo_catalog
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-mo_cost_unit" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: mo_cost_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-mo_prices_history" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: mo_prices_history
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-opex_budget" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: opex_budget
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-opex_cycle_batches" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: opex_cycle_batches
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-opex_cycle_defs" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: opex_cycle_defs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-opex_cycle_rules" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: opex_cycle_rules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-opex_staging-materials-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: opex_staging (materials pipeline)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-opr_rates_snapshot" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: opr_rates_snapshot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-ovh_bases_year" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: ovh_bases_year
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-ovh_cost_unit" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: ovh_cost_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-ovh_flat" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: ovh_flat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-ovh_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: ovh_nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-ovh_tariffs" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: ovh_tariffs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-ovh_tariffs_new" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: ovh_tariffs_new
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-ovh_tariffs_wide_bak" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: ovh_tariffs_wide_bak
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-personnel_monthly" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: personnel_monthly
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-price_scenarios-materials-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: price_scenarios (materials pipeline)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-prod_budget" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: prod_budget
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-rm_price_load-materials-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: rm_price_load (materials pipeline)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-rm_prices-materials-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: rm_prices (materials pipeline)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-routing_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: routing_nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-routing_operations" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: routing_operations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-routing_tree" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: routing_tree
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-routings" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: routings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-rule_scope" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: rule_scope
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-rule_sets" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: rule_sets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-rules" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: rules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-run_history" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: run_history
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-run_log" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: run_log
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-schema_version" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: schema_version
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-scrap_cost_unit" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: scrap_cost_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-sqlite_sequence" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: sqlite_sequence
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-transfer_batches" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: transfer_batches
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-transfer_opex_items" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: transfer_opex_items
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-transfer_personnel_items" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: transfer_personnel_items
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-transfer_rule_recipients" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: transfer_rule_recipients
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-transfer_rules" class="md-nav__link">
    <span class="md-ellipsis">
      TABLE: transfer_rules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-mo_last_price_current" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: mo_last_price_current
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-opex_budget_effective" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: opex_budget_effective
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-ovh_tariffs_wide_compat" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: ovh_tariffs_wide_compat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-personnel_yearly" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: personnel_yearly
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-personnel_yearly_effective" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: personnel_yearly_effective
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_alloc_lineage" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_alloc_lineage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_allocation_rule_effective" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_allocation_rule_effective
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_cogs_unit" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_cogs_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_component_pools" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_component_pools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_driver_catalog" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_driver_catalog
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_driver_values" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_driver_values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_elem_component_map" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_elem_component_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_item_cg" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_item_cg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_labor_cost_unit_total" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_labor_cost_unit_total
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_opr_cost_unit_total" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_opr_cost_unit_total
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_ovh_cost_unit" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_ovh_cost_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_ovh_flat_compat" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_ovh_flat_compat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_price_by_article" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_price_by_article
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_price_by_scenario-materials-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_price_by_scenario (materials pipeline)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_prod_budget_active" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_prod_budget_active
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_rate_parity" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_rate_parity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-v_recon_checks" class="md-nav__link">
    <span class="md-ellipsis">
      VIEW: v_recon_checks
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="db_schema">DB_SCHEMA<a class="headerlink" href="#db_schema" title="Permanent link">&para;</a></h1>
<blockquote>
<p>Generated: 2025-10-20 16:25 (local)
Commit: 5fb6b11</p>
</blockquote>
<p><em>Schema built by</em>: <code>db.schema.ensure_schema</code></p>
<h2 id="objects">Objects<a class="headerlink" href="#objects" title="Permanent link">&para;</a></h2>
<ul>
<li>Tables:</li>
<li><a href="#table-active_alloc_sets">TABLE: active_alloc_sets</a></li>
<li><a href="#table-active_periods">TABLE: active_periods</a></li>
<li><a href="#table-active_scenarios">TABLE: active_scenarios</a></li>
<li><a href="#table-activity_to_routing">TABLE: activity_to_routing</a></li>
<li><a href="#table-bom">TABLE: bom</a></li>
<li><a href="#table-bom_spec_components">TABLE: bom_spec_components</a></li>
<li><a href="#table-bom_specs">TABLE: bom_specs</a></li>
<li><a href="#table-bom_specs_new">TABLE: bom_specs_new</a></li>
<li><a href="#table-commodity_map">TABLE: commodity_map</a></li>
<li><a href="#table-cost_allocations">TABLE: cost_allocations</a></li>
<li><a href="#table-cost_rates">TABLE: cost_rates</a></li>
<li><a href="#table-dep_cc_map">TABLE: dep_cc_map</a></li>
<li><a href="#table-depr_rates_snapshot">TABLE: depr_rates_snapshot</a></li>
<li><a href="#table-driver_sets">TABLE: driver_sets</a></li>
<li><a href="#table-driver_values">TABLE: driver_values</a></li>
<li><a href="#table-drivers">TABLE: drivers</a></li>
<li><a href="#table-elem_to_ovh">TABLE: elem_to_ovh</a></li>
<li><a href="#table-fact_measures">TABLE: fact_measures</a></li>
<li><a href="#table-item_nodes">TABLE: item_nodes</a></li>
<li><a href="#table-items">TABLE: items</a></li>
<li><a href="#table-lineage_links">TABLE: lineage_links</a></li>
<li><a href="#table-mfc_cc_set_items">TABLE: mfc_cc_set_items</a></li>
<li><a href="#table-mfc_cc_sets">TABLE: mfc_cc_sets</a></li>
<li><a href="#table-mfc_elem_set_items">TABLE: mfc_elem_set_items</a></li>
<li><a href="#table-mfc_elem_sets">TABLE: mfc_elem_sets</a></li>
<li><a href="#table-mfc_report_defs">TABLE: mfc_report_defs</a></li>
<li><a href="#table-mfc_report_line_rules">TABLE: mfc_report_line_rules</a></li>
<li><a href="#table-mfc_report_lines">TABLE: mfc_report_lines</a></li>
<li><a href="#table-mo_catalog">TABLE: mo_catalog</a></li>
<li><a href="#table-mo_cost_unit">TABLE: mo_cost_unit</a></li>
<li><a href="#table-mo_prices_history">TABLE: mo_prices_history</a></li>
<li><a href="#table-opex_budget">TABLE: opex_budget</a></li>
<li><a href="#table-opex_cycle_batches">TABLE: opex_cycle_batches</a></li>
<li><a href="#table-opex_cycle_defs">TABLE: opex_cycle_defs</a></li>
<li><a href="#table-opex_cycle_rules">TABLE: opex_cycle_rules</a></li>
<li><a href="#table-opex_staging">TABLE: opex_staging (materials pipeline)</a></li>
<li><a href="#table-opr_rates_snapshot">TABLE: opr_rates_snapshot</a></li>
<li><a href="#table-ovh_bases_year">TABLE: ovh_bases_year</a></li>
<li><a href="#table-ovh_cost_unit">TABLE: ovh_cost_unit</a></li>
<li><a href="#table-ovh_flat">TABLE: ovh_flat</a></li>
<li><a href="#table-ovh_nodes">TABLE: ovh_nodes</a></li>
<li><a href="#table-ovh_tariffs">TABLE: ovh_tariffs</a></li>
<li><a href="#table-ovh_tariffs_new">TABLE: ovh_tariffs_new</a></li>
<li><a href="#table-ovh_tariffs_wide_bak">TABLE: ovh_tariffs_wide_bak</a></li>
<li><a href="#table-personnel_monthly">TABLE: personnel_monthly</a></li>
<li><a href="#table-price_scenarios">TABLE: price_scenarios (materials pipeline)</a></li>
<li><a href="#table-prod_budget">TABLE: prod_budget</a></li>
<li><a href="#table-rm_price_load">TABLE: rm_price_load (materials pipeline)</a></li>
<li><a href="#table-rm_prices">TABLE: rm_prices (materials pipeline)</a></li>
<li><a href="#table-routing_nodes">TABLE: routing_nodes</a></li>
<li><a href="#table-routing_operations">TABLE: routing_operations</a></li>
<li><a href="#table-routing_tree">TABLE: routing_tree</a></li>
<li><a href="#table-routings">TABLE: routings</a></li>
<li><a href="#table-rule_scope">TABLE: rule_scope</a></li>
<li><a href="#table-rule_sets">TABLE: rule_sets</a></li>
<li><a href="#table-rules">TABLE: rules</a></li>
<li><a href="#table-run_history">TABLE: run_history</a></li>
<li><a href="#table-run_log">TABLE: run_log</a></li>
<li><a href="#table-schema_version">TABLE: schema_version</a></li>
<li><a href="#table-scrap_cost_unit">TABLE: scrap_cost_unit</a></li>
<li><a href="#table-sqlite_sequence">TABLE: sqlite_sequence</a></li>
<li><a href="#table-transfer_batches">TABLE: transfer_batches</a></li>
<li><a href="#table-transfer_opex_items">TABLE: transfer_opex_items</a></li>
<li><a href="#table-transfer_personnel_items">TABLE: transfer_personnel_items</a></li>
<li><a href="#table-transfer_rule_recipients">TABLE: transfer_rule_recipients</a></li>
<li><a href="#table-transfer_rules">TABLE: transfer_rules</a></li>
<li>Views:</li>
<li><a href="#view-mo_last_price_current">VIEW: mo_last_price_current</a></li>
<li><a href="#view-opex_budget_effective">VIEW: opex_budget_effective</a></li>
<li><a href="#view-ovh_tariffs_wide_compat">VIEW: ovh_tariffs_wide_compat</a></li>
<li><a href="#view-personnel_yearly">VIEW: personnel_yearly</a></li>
<li><a href="#view-personnel_yearly_effective">VIEW: personnel_yearly_effective</a></li>
<li><a href="#view-v_alloc_lineage">VIEW: v_alloc_lineage</a></li>
<li><a href="#view-v_allocation_rule_effective">VIEW: v_allocation_rule_effective</a></li>
<li><a href="#view-v_cogs_unit">VIEW: v_cogs_unit</a></li>
<li><a href="#view-v_component_pools">VIEW: v_component_pools</a></li>
<li><a href="#view-v_driver_catalog">VIEW: v_driver_catalog</a></li>
<li><a href="#view-v_driver_values">VIEW: v_driver_values</a></li>
<li><a href="#view-v_elem_component_map">VIEW: v_elem_component_map</a></li>
<li><a href="#view-v_item_cg">VIEW: v_item_cg</a></li>
<li><a href="#view-v_labor_cost_unit_total">VIEW: v_labor_cost_unit_total</a></li>
<li><a href="#view-v_opr_cost_unit_total">VIEW: v_opr_cost_unit_total</a></li>
<li><a href="#view-v_ovh_cost_unit">VIEW: v_ovh_cost_unit</a></li>
<li><a href="#view-v_ovh_flat_compat">VIEW: v_ovh_flat_compat</a></li>
<li><a href="#view-v_price_by_article">VIEW: v_price_by_article</a></li>
<li><a href="#view-v_price_by_scenario">VIEW: v_price_by_scenario (materials pipeline)</a></li>
<li><a href="#view-v_prod_budget_active">VIEW: v_prod_budget_active</a></li>
<li><a href="#view-v_rate_parity">VIEW: v_rate_parity</a></li>
<li><a href="#view-v_recon_checks">VIEW: v_recon_checks</a></li>
</ul>
<p><a id="table-active_alloc_sets"></a></p>
<h2 id="table-active_alloc_sets">TABLE: active_alloc_sets<a class="headerlink" href="#table-active_alloc_sets" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">active_alloc_sets</span><span class="p">(</span>
<span class="w">          </span><span class="n">scenario</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">          </span><span class="n">rule_set_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">          </span><span class="n">valid_from</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">          </span><span class="n">valid_to</span><span class="w">   </span><span class="nb">TEXT</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>scenario</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>rule_set_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>valid_from</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>valid_to</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-active_periods"></a></p>
<h2 id="table-active_periods">TABLE: active_periods<a class="headerlink" href="#table-active_periods" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">active_periods</span><span class="p">(</span>
<span class="w">          </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">CHECK</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="w">          </span><span class="n">month_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="c1">-- &#39;YYYY-MM&#39;</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>month_code</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-active_scenarios"></a></p>
<h2 id="table-active_scenarios">TABLE: active_scenarios<a class="headerlink" href="#table-active_scenarios" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">active_scenarios</span><span class="p">(</span>
<span class="w">      </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="w">      </span><span class="n">vol_scenario</span><span class="w">   </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">  </span><span class="c1">-- например &#39;BG26_VOL&#39;</span>
<span class="w">      </span><span class="n">price_scenario</span><span class="w"> </span><span class="nb">TEXT</span><span class="w">   </span><span class="c1">-- например &#39;FC3&#39; или &#39;BG26&#39; (если будешь именовать price-сценарии как в price-loads)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>vol_scenario</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>price_scenario</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-activity_to_routing"></a></p>
<h2 id="table-activity_to_routing">TABLE: activity_to_routing<a class="headerlink" href="#table-activity_to_routing" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">activity_to_routing</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">activity_code</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">routing_node_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">activity_code</span><span class="p">,</span><span class="w"> </span><span class="n">routing_node_id</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>activity_code</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>routing_node_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
</tbody>
</table>
<p><a id="table-bom"></a></p>
<h2 id="table-bom">TABLE: bom<a class="headerlink" href="#table-bom" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">bom</span><span class="p">(</span>
<span class="w">      </span><span class="n">parent_item_id</span><span class="w">    </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">component_item_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">qty_per_unit</span><span class="w">      </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">CHECK</span><span class="p">(</span><span class="n">qty_per_unit</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">),</span>
<span class="w">      </span><span class="n">valid_from</span><span class="w">        </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">valid_to</span><span class="w">          </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="k">level</span><span class="w">             </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">path</span><span class="w">              </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">parent_item_id</span><span class="p">,</span><span class="w"> </span><span class="n">component_item_id</span><span class="p">,</span><span class="w"> </span><span class="n">valid_from</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>parent_item_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>component_item_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>qty_per_unit</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>valid_from</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>valid_to</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>level</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>path</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-bom_spec_components"></a></p>
<h2 id="table-bom_spec_components">TABLE: bom_spec_components<a class="headerlink" href="#table-bom_spec_components" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">bom_spec_components</span><span class="p">(</span>
<span class="w">      </span><span class="n">spec_code</span><span class="w">    </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">line_no</span><span class="w">      </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">component_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">qty_per_spec</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">CHECK</span><span class="p">(</span><span class="n">qty_per_spec</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">),</span>
<span class="w">      </span><span class="n">uom</span><span class="w">          </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="k">operation</span><span class="w">    </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">stage</span><span class="w">        </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">valid_from</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;1900-01-01&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="n">valid_to</span><span class="w">     </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;2999-12-31&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">spec_code</span><span class="p">,</span><span class="w"> </span><span class="n">line_no</span><span class="p">,</span><span class="w"> </span><span class="n">valid_from</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>spec_code</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>line_no</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>component_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>qty_per_spec</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>uom</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>operation</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>stage</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>valid_from</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'1900-01-01'</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>valid_to</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'2999-12-31'</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-bom_specs"></a></p>
<h2 id="table-bom_specs">TABLE: bom_specs<a class="headerlink" href="#table-bom_specs" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">bom_specs</span><span class="p">(</span>
<span class="w">      </span><span class="n">spec_code</span><span class="w">  </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">      </span><span class="n">product_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">batch_size</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">CHECK</span><span class="p">(</span><span class="n">batch_size</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">),</span>
<span class="w">      </span><span class="n">batch_uom</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">valid_from</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;1900-01-01&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="n">valid_to</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;2999-12-31&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="n">is_default</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">CHECK</span><span class="p">(</span><span class="n">is_default</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>spec_code</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>product_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>batch_size</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>batch_uom</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>valid_from</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'1900-01-01'</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>valid_to</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'2999-12-31'</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>is_default</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>1</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-bom_specs_new"></a></p>
<h2 id="table-bom_specs_new">TABLE: bom_specs_new<a class="headerlink" href="#table-bom_specs_new" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">bom_specs_new</span><span class="p">(</span>
<span class="w">              </span><span class="n">spec_code</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">              </span><span class="n">product_id</span><span class="w">  </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">              </span><span class="n">batch_size</span><span class="w">  </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
<span class="w">              </span><span class="n">batch_uom</span><span class="w">   </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">              </span><span class="n">valid_from</span><span class="w">  </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">              </span><span class="n">valid_to</span><span class="w">    </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;2999-12-31&#39;</span><span class="p">,</span>
<span class="w">              </span><span class="n">is_default</span><span class="w">  </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">              </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">spec_code</span><span class="p">,</span><span class="w"> </span><span class="n">valid_from</span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>spec_code</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>product_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>batch_size</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>1.0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>batch_uom</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>valid_from</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>valid_to</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'2999-12-31'</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>is_default</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>1</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-commodity_map"></a></p>
<h2 id="table-commodity_map">TABLE: commodity_map<a class="headerlink" href="#table-commodity_map" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">commodity_map</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">matl_prefix</span><span class="w">            </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">   </span><span class="c1">-- например &#39;123&#39;</span>
<span class="w">        </span><span class="n">matl_group_text_opt</span><span class="w">    </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">               </span><span class="c1">-- опционально: полное имя Matl Group</span>
<span class="w">        </span><span class="n">commodity_group</span><span class="w">        </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">      </span><span class="c1">-- номер CG, например &#39;123&#39;</span>
<span class="w">        </span><span class="n">commodity_group_text</span><span class="w">   </span><span class="nb">TEXT</span><span class="w">                </span><span class="c1">-- описание CG</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>matl_prefix</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>matl_group_text_opt</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>commodity_group</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>commodity_group_text</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-cost_allocations"></a></p>
<h2 id="table-cost_allocations">TABLE: cost_allocations<a class="headerlink" href="#table-cost_allocations" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">cost_allocations</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">period</span><span class="w">         </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">              </span><span class="c1">-- &#39;YYYY-MM&#39;</span>
<span class="w">            </span><span class="n">scenario</span><span class="w">       </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;BASE&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="n">component_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">              </span><span class="c1">-- e.g., &#39;LABOR_DIRECT&#39;</span>
<span class="w">            </span><span class="n">product_id</span><span class="w">     </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">cc_id</span><span class="w">          </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">rule_id</span><span class="w">        </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">amount</span><span class="w">         </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">weight</span><span class="w">         </span><span class="nb">REAL</span><span class="p">,</span>
<span class="w">            </span><span class="n">run_id</span><span class="w">         </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="n">component_code</span><span class="p">,</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">rule_id</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>period</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>scenario</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'BASE'</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>component_code</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>product_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>rule_id</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>amount</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>weight</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>run_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-cost_rates"></a></p>
<h2 id="table-cost_rates">TABLE: cost_rates<a class="headerlink" href="#table-cost_rates" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">cost_rates</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">period_or_year</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">scenario</span><span class="w">       </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="n">component_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">cc_id</span><span class="w">          </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="n">product_id</span><span class="w">     </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="n">rate_value</span><span class="w">     </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">unit</span><span class="w">           </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">source</span><span class="w">         </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">run_id</span><span class="w">         </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">period_or_year</span><span class="p">,</span><span class="w"> </span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="n">component_code</span><span class="p">,</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">product_id</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>period_or_year</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>scenario</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>''</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>component_code</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>''</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>product_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>''</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>rate_value</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>unit</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>source</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>run_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-dep_cc_map"></a></p>
<h2 id="table-dep_cc_map">TABLE: dep_cc_map<a class="headerlink" href="#table-dep_cc_map" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">dep_cc_map</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">department_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">  </span>
<span class="w">      </span><span class="n">cc_id</span><span class="w">           </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>department_code</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-depr_rates_snapshot"></a></p>
<h2 id="table-depr_rates_snapshot">TABLE: depr_rates_snapshot<a class="headerlink" href="#table-depr_rates_snapshot" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">depr_rates_snapshot</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">department_code</span><span class="w">     </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">cc_id</span><span class="w">               </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">rate_per_hour</span><span class="w">       </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">CHECK</span><span class="p">(</span><span class="n">rate_per_hour</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">),</span>
<span class="w">            </span><span class="n">hours_year</span><span class="w">          </span><span class="nb">REAL</span><span class="p">,</span>
<span class="w">            </span><span class="n">personnel_cost_year</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span>
<span class="w">            </span><span class="n">bud_year</span><span class="w">            </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">            </span><span class="n">currency</span><span class="w">            </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;RUB&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="k">source</span><span class="w">              </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">calc_at</span><span class="w">             </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">loaded_at</span><span class="w">           </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">))</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>department_code</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>rate_per_hour</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>hours_year</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>personnel_cost_year</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>bud_year</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>currency</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'RUB'</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>source</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>calc_at</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">9</td>
<td>loaded_at</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td>datetime('now')</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-driver_sets"></a></p>
<h2 id="table-driver_sets">TABLE: driver_sets<a class="headerlink" href="#table-driver_sets" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">driver_sets</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">set_id</span><span class="w">     </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">            </span><span class="n">name</span><span class="w">       </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">version</span><span class="w">    </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">            </span><span class="n">valid_from</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">valid_to</span><span class="w">   </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">status</span><span class="w">     </span><span class="nb">TEXT</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>set_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>name</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>version</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>valid_from</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>valid_to</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>status</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-driver_values"></a></p>
<h2 id="table-driver_values">TABLE: driver_values<a class="headerlink" href="#table-driver_values" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">driver_values</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">set_id</span><span class="w">      </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="k">period</span><span class="w">      </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                  </span><span class="c1">-- &#39;YYYY-MM&#39;</span>
<span class="w">            </span><span class="n">scenario</span><span class="w">    </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">driver_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">product_id</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">cc_id</span><span class="w">       </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">elem_id</span><span class="w">     </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">value</span><span class="w">       </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">unit</span><span class="w">        </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">source_ref</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">loaded_at</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">)),</span>
<span class="w">            </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">set_id</span><span class="p">,</span><span class="w"> </span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">driver_code</span><span class="p">,</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">cc_id</span><span class="p">),</span>
<span class="w">            </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">driver_code</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">drivers</span><span class="p">(</span><span class="n">driver_code</span><span class="p">),</span>
<span class="w">            </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">set_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">driver_sets</span><span class="p">(</span><span class="n">set_id</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>set_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>period</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>scenario</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>driver_code</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>product_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>elem_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>value</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>unit</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">9</td>
<td>source_ref</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">10</td>
<td>loaded_at</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>datetime('now')</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- set_id -&gt; driver_sets(set_id) (on update NO ACTION, on delete NO ACTION, match NONE)
- driver_code -&gt; drivers(driver_code) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-drivers"></a></p>
<h2 id="table-drivers">TABLE: drivers<a class="headerlink" href="#table-drivers" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">drivers</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">driver_code</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">            </span><span class="n">name</span><span class="w">          </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">unit</span><span class="w">          </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">granularity</span><span class="w">   </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                    </span><span class="c1">-- e.g. product_cc, cc, product</span>
<span class="w">            </span><span class="n">agg_rule</span><span class="w">      </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                    </span><span class="c1">-- e.g. sum, avg</span>
<span class="w">            </span><span class="n">source_policy</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">is_ratio</span><span class="w">      </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">CHECK</span><span class="p">(</span><span class="n">is_ratio</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>driver_code</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>name</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>unit</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>granularity</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>agg_rule</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>source_policy</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>is_ratio</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-elem_to_ovh"></a></p>
<h2 id="table-elem_to_ovh">TABLE: elem_to_ovh<a class="headerlink" href="#table-elem_to_ovh" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">elem_to_ovh</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">elem_id</span><span class="w">    </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">ovh_node_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">ovh_node_id</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>elem_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>ovh_node_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
</tbody>
</table>
<p><a id="table-fact_measures"></a></p>
<h2 id="table-fact_measures">TABLE: fact_measures<a class="headerlink" href="#table-fact_measures" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">fact_measures</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">period</span><span class="w">        </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">scenario</span><span class="w">      </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="n">product_id</span><span class="w">    </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">component_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="n">measure_code</span><span class="w">  </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">value</span><span class="w">         </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">unit</span><span class="w">          </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">component_code</span><span class="p">,</span><span class="w"> </span><span class="n">measure_code</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>period</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>scenario</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>''</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>product_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>component_code</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>''</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>measure_code</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>value</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>unit</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-item_nodes"></a></p>
<h2 id="table-item_nodes">TABLE: item_nodes<a class="headerlink" href="#table-item_nodes" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">item_nodes</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">node_id</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">            </span><span class="n">parent_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">name</span><span class="w">      </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">level</span><span class="w">     </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">            </span><span class="n">path</span><span class="w">      </span><span class="nb">TEXT</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>node_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>parent_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>name</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>level</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>path</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-items"></a></p>
<h2 id="table-items">TABLE: items<a class="headerlink" href="#table-items" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">items</span><span class="p">(</span>
<span class="w">      </span><span class="n">item_id</span><span class="w">     </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">      </span><span class="n">article</span><span class="w">     </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">name</span><span class="w">        </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">uom</span><span class="w">         </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">is_produced</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">routing_group</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="n">ovh_group_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="n">matl_group</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="n">product_hierarchy</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>item_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>article</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>name</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>uom</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>is_produced</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>routing_group</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>ovh_group_code</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>matl_group</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>product_hierarchy</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-lineage_links"></a></p>
<h2 id="table-lineage_links">TABLE: lineage_links<a class="headerlink" href="#table-lineage_links" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">lineage_links</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">src_table</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">src_pk</span><span class="w">    </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">dst_table</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">dst_pk</span><span class="w">    </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">rule_id</span><span class="w">   </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">            </span><span class="n">run_id</span><span class="w">    </span><span class="nb">TEXT</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>src_table</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>src_pk</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>dst_table</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>dst_pk</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>rule_id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>run_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-mfc_cc_set_items"></a></p>
<h2 id="table-mfc_cc_set_items">TABLE: mfc_cc_set_items<a class="headerlink" href="#table-mfc_cc_set_items" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">mfc_cc_set_items</span><span class="p">(</span>
<span class="w">        </span><span class="n">set_id</span><span class="w">  </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">cc_id</span><span class="w">   </span><span class="nb">TEXT</span><span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">set_id</span><span class="p">,</span><span class="w"> </span><span class="n">cc_id</span><span class="p">),</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">set_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">mfc_cc_sets</span><span class="p">(</span><span class="n">set_id</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>set_id</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- set_id -&gt; mfc_cc_sets(set_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-mfc_cc_sets"></a></p>
<h2 id="table-mfc_cc_sets">TABLE: mfc_cc_sets<a class="headerlink" href="#table-mfc_cc_sets" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">mfc_cc_sets</span><span class="p">(</span>
<span class="w">        </span><span class="n">set_id</span><span class="w">      </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">        </span><span class="n">set_name</span><span class="w">    </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">expand_mode</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;leaves&#39;</span><span class="w">   </span><span class="c1">-- &#39;leaves&#39; | &#39;subtree&#39; | &#39;exact&#39;</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>set_id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>set_name</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>expand_mode</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'leaves'</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-mfc_elem_set_items"></a></p>
<h2 id="table-mfc_elem_set_items">TABLE: mfc_elem_set_items<a class="headerlink" href="#table-mfc_elem_set_items" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">mfc_elem_set_items</span><span class="p">(</span>
<span class="w">        </span><span class="n">set_id</span><span class="w">  </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">elem_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">set_id</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span><span class="p">),</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">set_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">mfc_elem_sets</span><span class="p">(</span><span class="n">set_id</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>set_id</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>elem_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- set_id -&gt; mfc_elem_sets(set_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-mfc_elem_sets"></a></p>
<h2 id="table-mfc_elem_sets">TABLE: mfc_elem_sets<a class="headerlink" href="#table-mfc_elem_sets" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">mfc_elem_sets</span><span class="p">(</span>
<span class="w">        </span><span class="n">set_id</span><span class="w">      </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">        </span><span class="n">set_name</span><span class="w">    </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">expand_mode</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;subtree&#39;</span><span class="w">  </span><span class="c1">-- &#39;subtree&#39; | &#39;leaves&#39; | &#39;exact&#39;</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>set_id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>set_name</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>expand_mode</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'subtree'</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-mfc_report_defs"></a></p>
<h2 id="table-mfc_report_defs">TABLE: mfc_report_defs<a class="headerlink" href="#table-mfc_report_defs" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">mfc_report_defs</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">report_id</span><span class="w">       </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">                 </span><span class="c1">-- &#39;TARGET_2026&#39;</span>
<span class="w">        </span><span class="n">name</span><span class="w">            </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                    </span><span class="c1">-- &#39;Target Cost 2026&#39;</span>
<span class="w">        </span><span class="n">bud_year</span><span class="w">        </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                 </span><span class="c1">-- 2026</span>
<span class="w">        </span><span class="n">vol_scenario</span><span class="w">    </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                             </span><span class="c1">-- NULL = брать из active_scenarios</span>
<span class="w">        </span><span class="n">price_scenario</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                             </span><span class="c1">-- NULL = брать из active_scenarios</span>
<span class="w">        </span><span class="n">created_at</span><span class="w">      </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">))</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>report_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>name</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>bud_year</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>vol_scenario</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>price_scenario</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>created_at</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td>datetime('now')</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-mfc_report_line_rules"></a></p>
<h2 id="table-mfc_report_line_rules">TABLE: mfc_report_line_rules<a class="headerlink" href="#table-mfc_report_line_rules" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">mfc_report_line_rules</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">report_id</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">line_no</span><span class="w">     </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">rule_no</span><span class="w">     </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                     </span><span class="c1">-- чтобы в строке было несколько правил</span>
<span class="w">        </span><span class="n">source_type</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                        </span><span class="c1">-- см. перечисление выше</span>
<span class="w">        </span><span class="n">cc_root</span><span class="w">     </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                                 </span><span class="c1">-- корень дерева ЦЗ (NULL = без фильтра)</span>
<span class="w">        </span><span class="n">elem_root</span><span class="w">   </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                                 </span><span class="c1">-- корень дерева элементов (NULL = без фильтра)</span>
<span class="w">        </span><span class="n">cost_type</span><span class="w">   </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                                 </span><span class="c1">-- подтип источника (напр., &#39;machine&#39;|&#39;ext_tools&#39; для depr)</span>
<span class="w">        </span><span class="n">weight</span><span class="w">      </span><span class="nb">REAL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w">                     </span><span class="c1">-- коэффициент (+/-/доля)</span>
<span class="w">        </span><span class="n">note</span><span class="w">        </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="n">cc_set_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="n">elem_set_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">        </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">report_id</span><span class="p">,</span><span class="w"> </span><span class="n">line_no</span><span class="p">,</span><span class="w"> </span><span class="n">rule_no</span><span class="p">),</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">report_id</span><span class="p">,</span><span class="w"> </span><span class="n">line_no</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">mfc_report_lines</span><span class="p">(</span><span class="n">report_id</span><span class="p">,</span><span class="w"> </span><span class="n">line_no</span><span class="p">),</span>
<span class="w">        </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">source_type</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="s1">&#39;material&#39;</span><span class="p">,</span><span class="s1">&#39;subcontracting&#39;</span><span class="p">,</span><span class="s1">&#39;scrap&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;opex&#39;</span><span class="p">,</span><span class="s1">&#39;depr&#39;</span><span class="p">,</span><span class="s1">&#39;structure&#39;</span><span class="p">,</span><span class="s1">&#39;acos&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;trading_ic&#39;</span><span class="p">,</span><span class="s1">&#39;trading_ext&#39;</span>
<span class="w">        </span><span class="p">))</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>report_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>line_no</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>rule_no</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>source_type</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>cc_root</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>elem_root</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>cost_type</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>weight</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td>1.0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>note</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">9</td>
<td>cc_set_id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">10</td>
<td>elem_set_id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- report_id -&gt; mfc_report_lines(report_id) (on update NO ACTION, on delete NO ACTION, match NONE)
- line_no -&gt; mfc_report_lines(line_no) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-mfc_report_lines"></a></p>
<h2 id="table-mfc_report_lines">TABLE: mfc_report_lines<a class="headerlink" href="#table-mfc_report_lines" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">mfc_report_lines</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">report_id</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">line_no</span><span class="w">     </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                     </span><span class="c1">-- порядок вывода</span>
<span class="w">        </span><span class="n">report_line</span><span class="w"> </span><span class="nb">TEXT</span><span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                     </span><span class="c1">-- заголовок строки в отчёте</span>
<span class="w">        </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">report_id</span><span class="p">,</span><span class="w"> </span><span class="n">line_no</span><span class="p">),</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">report_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">mfc_report_defs</span><span class="p">(</span><span class="n">report_id</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>report_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>line_no</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>report_line</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- report_id -&gt; mfc_report_defs(report_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-mo_catalog"></a></p>
<h2 id="table-mo_catalog">TABLE: mo_catalog<a class="headerlink" href="#table-mo_catalog" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">mo_catalog</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">before_item_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">after_item_id</span><span class="w">  </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">is_active</span><span class="w">      </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="k">source</span><span class="w">         </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">        </span><span class="n">loaded_at</span><span class="w">      </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">before_item_id</span><span class="p">,</span><span class="w"> </span><span class="n">after_item_id</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>before_item_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>after_item_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>is_active</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>source</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>loaded_at</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-mo_cost_unit"></a></p>
<h2 id="table-mo_cost_unit">TABLE: mo_cost_unit<a class="headerlink" href="#table-mo_cost_unit" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">mo_cost_unit</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">product_id</span><span class="w">          </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">component_item_id</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">qty_per_unit</span><span class="w">        </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">price</span><span class="w">               </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">amount</span><span class="w">              </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">currency</span><span class="w">            </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;RUB&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="n">computed_at</span><span class="w">         </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">component_item_id</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>product_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>component_item_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>qty_per_unit</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>price</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>amount</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>currency</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'RUB'</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>computed_at</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-mo_prices_history"></a></p>
<h2 id="table-mo_prices_history">TABLE: mo_prices_history<a class="headerlink" href="#table-mo_prices_history" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">mo_prices_history</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">after_item_id</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">price</span><span class="w">           </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">currency</span><span class="w">        </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;RUB&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="n">vendor</span><span class="w">          </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">        </span><span class="n">effective_from</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">        </span><span class="n">effective_to</span><span class="w">    </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">        </span><span class="k">source</span><span class="w">          </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">        </span><span class="n">loaded_at</span><span class="w">       </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>after_item_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>price</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>currency</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'RUB'</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>vendor</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>effective_from</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>effective_to</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>source</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>loaded_at</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-opex_budget"></a></p>
<h2 id="table-opex_budget">TABLE: opex_budget<a class="headerlink" href="#table-opex_budget" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">opex_budget</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w">                       </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">load_id</span><span class="w">                  </span><span class="nb">TEXT</span><span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">cc_id</span><span class="w">                    </span><span class="nb">TEXT</span><span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                 </span><span class="c1">-- FK → cc_nodes.cc_id</span>
<span class="w">    </span><span class="n">elem_id</span><span class="w">                  </span><span class="nb">TEXT</span><span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                 </span><span class="c1">-- FK → elem_nodes.elem_id</span>
<span class="w">    </span><span class="n">bud_year</span><span class="w">                 </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                 </span><span class="c1">-- например, 2026</span>
<span class="w">    </span><span class="n">amount</span><span class="w">                   </span><span class="nb">REAL</span><span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                 </span><span class="c1">-- нормализованная сумма</span>

<span class="w">    </span><span class="n">text_note</span><span class="w">                </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">comments</span><span class="w">                 </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">supplier_text</span><span class="w">            </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">source_sheet</span><span class="w">             </span><span class="nb">TEXT</span><span class="p">,</span>

<span class="w">    </span><span class="n">created_at</span><span class="w">               </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%s&#39;</span><span class="p">,</span><span class="s1">&#39;now&#39;</span><span class="p">)),</span>

<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">cc_id</span><span class="p">)</span><span class="w">   </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">cc_nodes</span><span class="p">(</span><span class="n">cc_id</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">elem_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">elem_nodes</span><span class="p">(</span><span class="n">elem_id</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>load_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>elem_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>bud_year</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>amount</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>text_note</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>comments</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>supplier_text</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">9</td>
<td>source_sheet</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">10</td>
<td>created_at</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>strftime('%s','now')</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- elem_id -&gt; elem_nodes(elem_id) (on update NO ACTION, on delete NO ACTION, match NONE)
- cc_id -&gt; cc_nodes(cc_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-opex_cycle_batches"></a></p>
<h2 id="table-opex_cycle_batches">TABLE: opex_cycle_batches<a class="headerlink" href="#table-opex_cycle_batches" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">opex_cycle_batches</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">batch_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">      </span><span class="n">cycle_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">transfer_batches</span><span class="p">(</span><span class="n">batch_id</span><span class="p">),</span>
<span class="w">      </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">cycle_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">opex_cycle_defs</span><span class="p">(</span><span class="n">cycle_id</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>batch_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>cycle_id</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- cycle_id -&gt; opex_cycle_defs(cycle_id) (on update NO ACTION, on delete NO ACTION, match NONE)
- batch_id -&gt; transfer_batches(batch_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-opex_cycle_defs"></a></p>
<h2 id="table-opex_cycle_defs">TABLE: opex_cycle_defs<a class="headerlink" href="#table-opex_cycle_defs" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">opex_cycle_defs</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">cycle_id</span><span class="w">    </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">        </span><span class="n">name</span><span class="w">        </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">            </span><span class="c1">-- человекочитаемое имя &quot;Buildings→Prod&quot;</span>
<span class="w">        </span><span class="n">bud_year</span><span class="w">    </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">         </span><span class="c1">-- к какому году относится набор</span>
<span class="w">        </span><span class="n">elem_root</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">            </span><span class="c1">-- корень группы элементов</span>
<span class="w">        </span><span class="n">enabled</span><span class="w">     </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">rule_id</span><span class="w">     </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">        </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>cycle_id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>name</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>bud_year</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>elem_root</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>enabled</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>rule_id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-opex_cycle_rules"></a></p>
<h2 id="table-opex_cycle_rules">TABLE: opex_cycle_rules<a class="headerlink" href="#table-opex_cycle_rules" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">opex_cycle_rules</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">cycle_id</span><span class="w">     </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">donor_cc_id</span><span class="w">  </span><span class="nb">TEXT</span><span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">to_cc_id</span><span class="w">     </span><span class="nb">TEXT</span><span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">to_elem_id</span><span class="w">   </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">        </span><span class="k">share</span><span class="w">        </span><span class="nb">REAL</span><span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">CHECK</span><span class="p">(</span><span class="k">share</span><span class="o">&gt;=</span><span class="mi">0</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">share</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">),</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">cycle_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">opex_cycle_defs</span><span class="p">(</span><span class="n">cycle_id</span><span class="p">),</span>
<span class="w">        </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">cycle_id</span><span class="p">,</span><span class="w"> </span><span class="n">donor_cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">to_cc_id</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>cycle_id</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>donor_cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>to_cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>to_elem_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>share</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- cycle_id -&gt; opex_cycle_defs(cycle_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-opex_staging"></a></p>
<h2 id="table-opex_staging-materials-pipeline">TABLE: opex_staging (materials pipeline)<a class="headerlink" href="#table-opex_staging-materials-pipeline" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">opex_staging</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w">                       </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">load_id</span><span class="w">                  </span><span class="nb">TEXT</span><span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                 </span><span class="c1">-- UUID загрузки</span>
<span class="w">    </span><span class="n">sheet_name</span><span class="w">               </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                             </span><span class="c1">-- имя листа Excel</span>
<span class="w">    </span><span class="n">cc_id</span><span class="w">                    </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                             </span><span class="c1">-- CC из исходника</span>
<span class="w">    </span><span class="n">cost_type</span><span class="w">                </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">account_descr</span><span class="w">            </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">bud_2026</span><span class="w">                 </span><span class="nb">REAL</span><span class="p">,</span><span class="w">                             </span><span class="c1">-- сумма из колонки &#39;BUD 2026&#39;</span>
<span class="w">    </span><span class="n">text_note</span><span class="w">                </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                             </span><span class="c1">-- &#39;Text&#39;</span>
<span class="w">    </span><span class="n">comments</span><span class="w">                 </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                             </span><span class="c1">-- &#39;Comments&#39;</span>
<span class="w">    </span><span class="n">supplier_text</span><span class="w">            </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                             </span><span class="c1">-- &#39;Suppliers/Text&#39;</span>

<span class="w">    </span><span class="n">mapped_elem_id</span><span class="w">           </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                             </span><span class="c1">-- результат правил (elem_id) или NULL</span>

<span class="w">    </span><span class="c1">-- флаги валидации</span>
<span class="w">    </span><span class="n">missing_cc</span><span class="w">               </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">       </span><span class="c1">-- 1 если CC не найден в БД</span>
<span class="w">    </span><span class="n">unmapped_elem</span><span class="w">            </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">       </span><span class="c1">-- 1 если правило не сработало</span>
<span class="w">    </span><span class="n">bad_amount</span><span class="w">               </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">       </span><span class="c1">-- 1 если bud_2026 пуст/нечисло</span>
<span class="w">    </span><span class="n">dup_candidate</span><span class="w">            </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">       </span><span class="c1">-- 1 если потенциальный дубль</span>

<span class="w">    </span><span class="n">created_at</span><span class="w">               </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%s&#39;</span><span class="p">,</span><span class="s1">&#39;now&#39;</span><span class="p">)),</span>

<span class="w">    </span><span class="c1">-- мягкие FK (без ON DELETE/UPDATE CASCADE, чтобы staging не падал при админ-операциях)</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">cc_id</span><span class="p">)</span><span class="w">       </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">cc_nodes</span><span class="p">(</span><span class="n">cc_id</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">mapped_elem_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">elem_nodes</span><span class="p">(</span><span class="n">elem_id</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>load_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>sheet_name</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>cost_type</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>account_descr</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>bud_2026</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>text_note</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>comments</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">9</td>
<td>supplier_text</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">10</td>
<td>mapped_elem_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">11</td>
<td>missing_cc</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">12</td>
<td>unmapped_elem</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">13</td>
<td>bad_amount</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">14</td>
<td>dup_candidate</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">15</td>
<td>created_at</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>strftime('%s','now')</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- mapped_elem_id -&gt; elem_nodes(elem_id) (on update NO ACTION, on delete NO ACTION, match NONE)
- cc_id -&gt; cc_nodes(cc_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-opr_rates_snapshot"></a></p>
<h2 id="table-opr_rates_snapshot">TABLE: opr_rates_snapshot<a class="headerlink" href="#table-opr_rates_snapshot" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">opr_rates_snapshot</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">department_code</span><span class="w">     </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">cc_id</span><span class="w">               </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">rate_per_hour</span><span class="w">       </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">CHECK</span><span class="p">(</span><span class="n">rate_per_hour</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">),</span>
<span class="w">            </span><span class="n">hours_year</span><span class="w">          </span><span class="nb">REAL</span><span class="p">,</span>
<span class="w">            </span><span class="n">personnel_cost_year</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span>
<span class="w">            </span><span class="n">bud_year</span><span class="w">            </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">            </span><span class="n">currency</span><span class="w">            </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;RUB&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="k">source</span><span class="w">              </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">calc_at</span><span class="w">             </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">loaded_at</span><span class="w">           </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">))</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>department_code</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>rate_per_hour</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>hours_year</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>personnel_cost_year</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>bud_year</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>currency</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'RUB'</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>source</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>calc_at</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">9</td>
<td>loaded_at</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td>datetime('now')</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-ovh_bases_year"></a></p>
<h2 id="table-ovh_bases_year">TABLE: ovh_bases_year<a class="headerlink" href="#table-ovh_bases_year" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ovh_bases_year</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">year</span><span class="w">            </span><span class="nb">INTEGER</span><span class="w">        </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">overhead_group</span><span class="w">  </span><span class="nb">TEXT</span><span class="w">           </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="c1">-- материалка за год и её доля в total по всем A001..A010</span>
<span class="w">        </span><span class="n">mat_base_year</span><span class="w">   </span><span class="nb">REAL</span><span class="w">           </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="n">mat_share</span><span class="w">       </span><span class="nb">REAL</span><span class="p">,</span>
<span class="w">        </span><span class="c1">-- исходные суммы (до распределения)</span>
<span class="w">        </span><span class="n">base_depr_src</span><span class="w">   </span><span class="nb">REAL</span><span class="w">           </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w">   </span><span class="c1">-- Аморт. ОПР (CC 25407 × MFC_PRIM_3)</span>
<span class="w">        </span><span class="n">base_log_src</span><span class="w">    </span><span class="nb">REAL</span><span class="w">           </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w">   </span><span class="c1">-- ОХР Логистика (P45/46/47 × MFC_PRIM)</span>
<span class="w">        </span><span class="n">base_adm_src</span><span class="w">    </span><span class="nb">REAL</span><span class="w">           </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w">   </span><span class="c1">-- ОХР Управленч. (P41/43/44/48 × MFC_PRIM) минус Аморт. ОПР</span>
<span class="w">        </span><span class="c1">-- распределённые суммы по долям mat_share</span>
<span class="w">        </span><span class="n">dist_depr</span><span class="w">       </span><span class="nb">REAL</span><span class="w">           </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="n">dist_log</span><span class="w">        </span><span class="nb">REAL</span><span class="w">           </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="n">dist_adm</span><span class="w">        </span><span class="nb">REAL</span><span class="w">           </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w">   </span><span class="c1">-- пока = base_adm_src×mat_share; затем пересчитаем через (труд+ОПР)</span>
<span class="w">        </span><span class="c1">-- происхождение / техполя</span>
<span class="w">        </span><span class="n">opex_load_ids</span><span class="w">   </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                                   </span><span class="c1">-- UUID списком (через запятую), если несколько загрузок</span>
<span class="w">        </span><span class="n">prod_months</span><span class="w">     </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                                   </span><span class="c1">-- например: &#39;2026-01..2026-12&#39;</span>
<span class="w">        </span><span class="n">calc_at</span><span class="w">         </span><span class="nb">TEXT</span><span class="w">           </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">)),</span>
<span class="w">        </span><span class="n">created_at</span><span class="w">      </span><span class="nb">INTEGER</span><span class="w">        </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%s&#39;</span><span class="p">,</span><span class="s1">&#39;now&#39;</span><span class="p">)),</span>
<span class="w">        </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">overhead_group</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>year</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>overhead_group</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>mat_base_year</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0.0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>mat_share</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>base_depr_src</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0.0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>base_log_src</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0.0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>base_adm_src</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0.0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>dist_depr</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0.0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>dist_log</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0.0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">9</td>
<td>dist_adm</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0.0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">10</td>
<td>opex_load_ids</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">11</td>
<td>prod_months</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">12</td>
<td>calc_at</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td>datetime('now')</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">13</td>
<td>created_at</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>strftime('%s','now')</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-ovh_cost_unit"></a></p>
<h2 id="table-ovh_cost_unit">TABLE: ovh_cost_unit<a class="headerlink" href="#table-ovh_cost_unit" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ovh_cost_unit</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">product_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">        </span><span class="n">depr_opr_cost</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w">  </span><span class="c1">-- Амортизация ОПР</span>
<span class="w">        </span><span class="n">log_cost</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w">       </span><span class="c1">-- ОХР логистика</span>
<span class="w">        </span><span class="n">adm_cost</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w">        </span><span class="c1">-- ОХР управленческие</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>product_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>depr_opr_cost</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0.0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>log_cost</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0.0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>adm_cost</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0.0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-ovh_flat"></a></p>
<h2 id="table-ovh_flat">TABLE: ovh_flat<a class="headerlink" href="#table-ovh_flat" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ovh_flat</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">product_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">overhead_group</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">driver_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">driver_value_per_unit</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span>
<span class="w">            </span><span class="k">source</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">year</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">            </span><span class="n">department_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="c1">-- legacy compatibility</span>
<span class="w">            </span><span class="n">mat_cost</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span>
<span class="w">            </span><span class="n">base_kind</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">base_value_per_unit</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span><span class="w"> </span><span class="n">node_product_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">overhead_group</span><span class="p">,</span><span class="w"> </span><span class="n">driver_code</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>product_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>overhead_group</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>driver_code</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>driver_value_per_unit</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>source</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>year</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>department_code</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>mat_cost</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>base_kind</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">9</td>
<td>base_value_per_unit</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">10</td>
<td>node_product_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-ovh_nodes"></a></p>
<h2 id="table-ovh_nodes">TABLE: ovh_nodes<a class="headerlink" href="#table-ovh_nodes" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ovh_nodes</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">node_id</span><span class="w">    </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">            </span><span class="n">parent_id</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">ovh_group</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">name</span><span class="w">       </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">level</span><span class="w">      </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">            </span><span class="n">path</span><span class="w">       </span><span class="nb">TEXT</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>node_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>parent_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>ovh_group</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>name</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>level</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>path</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-ovh_tariffs"></a></p>
<h2 id="table-ovh_tariffs">TABLE: ovh_tariffs<a class="headerlink" href="#table-ovh_tariffs" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ovh_tariffs</span><span class="w"> </span><span class="p">(</span>
<span class="w">                    </span><span class="n">overhead_group</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">                    </span><span class="k">year</span><span class="w">           </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">                    </span><span class="n">scenario</span><span class="w">       </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">cost_type</span><span class="w">      </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">                    </span><span class="k">share</span><span class="w">          </span><span class="nb">REAL</span><span class="p">,</span>
<span class="w">                    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">overhead_group</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="n">cost_type</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>overhead_group</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>year</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>scenario</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>''</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>cost_type</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>share</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-ovh_tariffs_new"></a></p>
<h2 id="table-ovh_tariffs_new">TABLE: ovh_tariffs_new<a class="headerlink" href="#table-ovh_tariffs_new" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ovh_tariffs_new</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">overhead_group</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="k">year</span><span class="w">           </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">scenario</span><span class="w">       </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="n">cost_type</span><span class="w">      </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="k">share</span><span class="w">          </span><span class="nb">REAL</span><span class="p">,</span>
<span class="w">            </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">overhead_group</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="n">cost_type</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>overhead_group</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>year</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>scenario</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>''</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>cost_type</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>share</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-ovh_tariffs_wide_bak"></a></p>
<h2 id="table-ovh_tariffs_wide_bak">TABLE: ovh_tariffs_wide_bak<a class="headerlink" href="#table-ovh_tariffs_wide_bak" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;ovh_tariffs_wide_bak&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">overhead_group</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="k">year</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">scrap_share</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span><span class="w">       </span><span class="c1">-- Брак: от материалов</span>
<span class="w">        </span><span class="n">depr_opr_share</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span><span class="w">    </span><span class="c1">-- Амортизация ОПР: от материалов</span>
<span class="w">        </span><span class="n">log_share</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span><span class="w">         </span><span class="c1">-- ОХР логистика: от материалов</span>
<span class="w">        </span><span class="n">adm_share</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span><span class="w">         </span><span class="c1">-- ОХР управленч.: от (труд + амортизация ОПР_по_группе)</span>
<span class="w">        </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">overhead_group</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>overhead_group</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>year</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>scrap_share</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>depr_opr_share</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>log_share</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>adm_share</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-personnel_monthly"></a></p>
<h2 id="table-personnel_monthly">TABLE: personnel_monthly<a class="headerlink" href="#table-personnel_monthly" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">personnel_monthly</span><span class="p">(</span>
<span class="w">            </span><span class="n">cc_id</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">ym</span><span class="w">      </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">         </span><span class="c1">-- &#39;YYYY-MM&#39;</span>
<span class="w">            </span><span class="n">headcount</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">CHECK</span><span class="p">(</span><span class="n">headcount</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">),</span>
<span class="w">            </span><span class="k">source</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">note</span><span class="w">    </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">loaded_at</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">)),</span>
<span class="w">            </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">ym</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>ym</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>headcount</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>source</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>note</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>loaded_at</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td>datetime('now')</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-price_scenarios"></a></p>
<h2 id="table-price_scenarios-materials-pipeline">TABLE: price_scenarios (materials pipeline)<a class="headerlink" href="#table-price_scenarios-materials-pipeline" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">price_scenarios</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">scenario_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">   </span><span class="c1">-- &#39;BG25&#39;, &#39;FC3&#39;, &#39;BG26&#39;, ...</span>
<span class="w">      </span><span class="n">asof_date</span><span class="w">     </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">       </span><span class="c1">-- &#39;YYYY-MM-DD&#39;</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>scenario_code</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>asof_date</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-prod_budget"></a></p>
<h2 id="table-prod_budget">TABLE: prod_budget<a class="headerlink" href="#table-prod_budget" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">prod_budget</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">product_id</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">month_code</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">   </span><span class="c1">-- &#39;YYYY-MM&#39;</span>
<span class="w">        </span><span class="n">qty</span><span class="w">          </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="c1">-- НОВОЕ:</span>
<span class="w">        </span><span class="n">scenario</span><span class="w">     </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;BASE&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">month_code</span><span class="p">,</span><span class="w"> </span><span class="n">scenario</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>product_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>month_code</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>qty</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>scenario</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'BASE'</td>
<td style="text-align: center;">3</td>
</tr>
</tbody>
</table>
<p><a id="table-rm_price_load"></a></p>
<h2 id="table-rm_price_load-materials-pipeline">TABLE: rm_price_load (materials pipeline)<a class="headerlink" href="#table-rm_price_load-materials-pipeline" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">rm_price_load</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">load_id</span><span class="w">     </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">        </span><span class="k">comment</span><span class="w">     </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">        </span><span class="k">source</span><span class="w">      </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">        </span><span class="n">price_date</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">        </span><span class="n">loaded_at</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">)),</span>
<span class="w">        </span><span class="n">created_by</span><span class="w">  </span><span class="nb">TEXT</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>load_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>comment</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>source</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>price_date</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>loaded_at</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>datetime('now')</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>created_by</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-rm_prices"></a></p>
<h2 id="table-rm_prices-materials-pipeline">TABLE: rm_prices (materials pipeline)<a class="headerlink" href="#table-rm_prices-materials-pipeline" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;rm_prices&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">item_code</span><span class="w">       </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">currency</span><span class="w">        </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;RUB&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="n">effective_from</span><span class="w">  </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                   </span><span class="c1">-- ключ для истории</span>
<span class="w">            </span><span class="n">price</span><span class="w">           </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">article</span><span class="w">         </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">uom</span><span class="w">             </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">load_id</span><span class="w">         </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">                   </span><span class="c1">-- uuid загрузки</span>
<span class="w">            </span><span class="k">source</span><span class="w">          </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">loaded_at</span><span class="w">       </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">)),</span>
<span class="w">            </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">item_code</span><span class="p">,</span><span class="w"> </span><span class="n">currency</span><span class="p">,</span><span class="w"> </span><span class="n">effective_from</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>item_code</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>currency</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>'RUB'</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>effective_from</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>price</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>article</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>uom</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>load_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>source</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td>loaded_at</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>datetime('now')</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-routing_nodes"></a></p>
<h2 id="table-routing_nodes">TABLE: routing_nodes<a class="headerlink" href="#table-routing_nodes" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">routing_nodes</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">node_id</span><span class="w">       </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">            </span><span class="n">parent_id</span><span class="w">     </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">routing_group</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">name</span><span class="w">          </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">level</span><span class="w">         </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">            </span><span class="n">path</span><span class="w">          </span><span class="nb">TEXT</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>node_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>parent_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>routing_group</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>name</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>level</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>path</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-routing_operations"></a></p>
<h2 id="table-routing_operations">TABLE: routing_operations<a class="headerlink" href="#table-routing_operations" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">routing_operations</span><span class="p">(</span>
<span class="w">      </span><span class="n">routing_op_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">      </span><span class="n">routing_id</span><span class="w">    </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">seq</span><span class="w">           </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="k">operation</span><span class="w">     </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">department</span><span class="w">    </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">hours</span><span class="w">         </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">CHECK</span><span class="p">(</span><span class="n">hours</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">),</span>
<span class="w">      </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">routing_id</span><span class="p">,</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>routing_op_id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>routing_id</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>seq</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>operation</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>department</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>hours</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-routing_tree"></a></p>
<h2 id="table-routing_tree">TABLE: routing_tree<a class="headerlink" href="#table-routing_tree" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">routing_tree</span><span class="p">(</span>
<span class="w">      </span><span class="n">root_product_id</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">node_product_id</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="k">level</span><span class="w">            </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">      </span><span class="n">qty_per_unit</span><span class="w">     </span><span class="nb">REAL</span><span class="p">,</span>
<span class="w">      </span><span class="n">path</span><span class="w">             </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">routing_id</span><span class="w">       </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">routing_group</span><span class="w">    </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">routing_name</span><span class="w">     </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">root_product_id</span><span class="p">,</span><span class="w"> </span><span class="n">node_product_id</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>root_product_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>node_product_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>level</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>qty_per_unit</td>
<td>REAL</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>path</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>routing_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>routing_group</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td>routing_name</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-routings"></a></p>
<h2 id="table-routings">TABLE: routings<a class="headerlink" href="#table-routings" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">routings</span><span class="p">(</span>
<span class="w">      </span><span class="n">routing_id</span><span class="w">   </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">      </span><span class="n">routing_group</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">spec_code</span><span class="w">     </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">item_id</span><span class="w">       </span><span class="nb">TEXT</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>routing_id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>routing_group</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>spec_code</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>item_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-rule_scope"></a></p>
<h2 id="table-rule_scope">TABLE: rule_scope<a class="headerlink" href="#table-rule_scope" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">rule_scope</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">rule_id</span><span class="w">     </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">cc_node_id</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">elem_node_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">rule_id</span><span class="p">,</span><span class="w"> </span><span class="n">cc_node_id</span><span class="p">,</span><span class="w"> </span><span class="n">elem_node_id</span><span class="p">),</span>
<span class="w">            </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">rule_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">rules</span><span class="p">(</span><span class="n">rule_id</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>rule_id</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>cc_node_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>elem_node_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">3</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- rule_id -&gt; rules(rule_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-rule_sets"></a></p>
<h2 id="table-rule_sets">TABLE: rule_sets<a class="headerlink" href="#table-rule_sets" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">rule_sets</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">rule_set_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">            </span><span class="n">name</span><span class="w">        </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">version</span><span class="w">     </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">            </span><span class="n">valid_from</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">valid_to</span><span class="w">    </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">status</span><span class="w">      </span><span class="nb">TEXT</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>rule_set_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>name</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>version</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>valid_from</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>valid_to</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>status</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-rules"></a></p>
<h2 id="table-rules">TABLE: rules<a class="headerlink" href="#table-rules" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">rule_id</span><span class="w">     </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">            </span><span class="n">rule_set_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">priority</span><span class="w">    </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">driver_code</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">params_json</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">rule_set_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">rule_sets</span><span class="p">(</span><span class="n">rule_set_id</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>rule_id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>rule_set_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>priority</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>driver_code</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>params_json</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- rule_set_id -&gt; rule_sets(rule_set_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-run_history"></a></p>
<h2 id="table-run_history">TABLE: run_history<a class="headerlink" href="#table-run_history" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">run_history</span><span class="p">(</span>
<span class="w">      </span><span class="n">run_id</span><span class="w">      </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">      </span><span class="n">started_at</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">ended_at</span><span class="w">    </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="k">scope</span><span class="w">       </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">             </span><span class="c1">-- e.g. &quot;all_produced&quot; | &quot;explicit_list&quot;</span>
<span class="w">      </span><span class="n">params_json</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">status</span><span class="w">      </span><span class="nb">TEXT</span><span class="w">              </span><span class="c1">-- &quot;ok&quot; | &quot;error&quot; | &quot;partial&quot;</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>run_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>started_at</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>ended_at</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>scope</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>params_json</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>status</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-run_log"></a></p>
<h2 id="table-run_log">TABLE: run_log<a class="headerlink" href="#table-run_log" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">run_log</span><span class="p">(</span>
<span class="w">      </span><span class="n">run_id</span><span class="w">      </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">step</span><span class="w">        </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">             </span><span class="c1">-- &quot;bom&quot; | &quot;tree&quot; | &quot;flat&quot; | &quot;hours&quot; | &quot;labor_cost&quot; | &quot;opr_cost&quot; | &quot;depr_cost&quot;</span>
<span class="w">      </span><span class="n">product_id</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="k">level</span><span class="w">       </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">             </span><span class="c1">-- &quot;INFO&quot; | &quot;WARN&quot; | &quot;ERROR&quot;</span>
<span class="w">      </span><span class="n">msg</span><span class="w">         </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">extra_json</span><span class="w">  </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">      </span><span class="n">ts</span><span class="w">          </span><span class="nb">TEXT</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>run_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>step</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>product_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>level</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>msg</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>extra_json</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td>ts</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-schema_version"></a></p>
<h2 id="table-schema_version">TABLE: schema_version<a class="headerlink" href="#table-schema_version" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">schema_version</span><span class="p">(</span><span class="k">version</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="n">applied_at</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">)))</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>version</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>name</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>applied_at</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td>datetime('now')</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-scrap_cost_unit"></a></p>
<h2 id="table-scrap_cost_unit">TABLE: scrap_cost_unit<a class="headerlink" href="#table-scrap_cost_unit" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">scrap_cost_unit</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">product_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">        </span><span class="n">scrap_cost</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>product_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>scrap_cost</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td>0.0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-sqlite_sequence"></a></p>
<h2 id="table-sqlite_sequence">TABLE: sqlite_sequence<a class="headerlink" href="#table-sqlite_sequence" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">sqlite_sequence</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">seq</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>name</td>
<td></td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>seq</td>
<td></td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="table-transfer_batches"></a></p>
<h2 id="table-transfer_batches">TABLE: transfer_batches<a class="headerlink" href="#table-transfer_batches" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">transfer_batches</span><span class="p">(</span>
<span class="w">            </span><span class="n">batch_id</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">   </span><span class="c1">-- UUID</span>
<span class="w">            </span><span class="n">bud_year</span><span class="w">   </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">rule_id</span><span class="w">    </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">created_at</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">)),</span>
<span class="w">            </span><span class="n">created_by</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">comment</span><span class="w">    </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">rule_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">transfer_rules</span><span class="p">(</span><span class="n">rule_id</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>batch_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>bud_year</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>rule_id</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>created_at</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td>datetime('now')</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>created_by</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>comment</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- rule_id -&gt; transfer_rules(rule_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-transfer_opex_items"></a></p>
<h2 id="table-transfer_opex_items">TABLE: transfer_opex_items<a class="headerlink" href="#table-transfer_opex_items" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">transfer_opex_items</span><span class="p">(</span>
<span class="w">            </span><span class="n">batch_id</span><span class="w">     </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">from_cc_id</span><span class="w">   </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">to_cc_id</span><span class="w">     </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">elem_id</span><span class="w">      </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">to_elem_id</span><span class="w">   </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">            </span><span class="n">amount_delta</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span><span class="w"> </span><span class="n">from_cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">to_cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span><span class="p">),</span>
<span class="w">            </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">transfer_batches</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>batch_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>from_cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>to_cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>elem_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>to_elem_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>amount_delta</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- batch_id -&gt; transfer_batches(batch_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-transfer_personnel_items"></a></p>
<h2 id="table-transfer_personnel_items">TABLE: transfer_personnel_items<a class="headerlink" href="#table-transfer_personnel_items" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;transfer_personnel_items&quot;</span><span class="p">(</span>
<span class="w">            </span><span class="n">id</span><span class="w">              </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">            </span><span class="n">batch_id</span><span class="w">        </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">from_cc_id</span><span class="w">      </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">            </span><span class="c1">-- в старых записях могло быть NULL</span>
<span class="w">            </span><span class="n">to_cc_id</span><span class="w">        </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">headcount_delta</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">transfer_batches</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>batch_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>from_cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>to_cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>headcount_delta</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- batch_id -&gt; transfer_batches(batch_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-transfer_rule_recipients"></a></p>
<h2 id="table-transfer_rule_recipients">TABLE: transfer_rule_recipients<a class="headerlink" href="#table-transfer_rule_recipients" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">transfer_rule_recipients</span><span class="p">(</span>
<span class="w">        </span><span class="n">rule_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">recipient_cc_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="k">share</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">rule_id</span><span class="p">,</span><span class="w"> </span><span class="n">recipient_cc_id</span><span class="p">),</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">rule_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">transfer_rules</span><span class="p">(</span><span class="n">rule_id</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>rule_id</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>recipient_cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>share</td>
<td>REAL</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>Foreign keys:</strong>
- rule_id -&gt; transfer_rules(rule_id) (on update NO ACTION, on delete NO ACTION, match NONE)</p>
<p><a id="table-transfer_rules"></a></p>
<h2 id="table-transfer_rules">TABLE: transfer_rules<a class="headerlink" href="#table-transfer_rules" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">transfer_rules</span><span class="p">(</span>
<span class="w">            </span><span class="n">rule_id</span><span class="w">        </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">            </span><span class="n">name</span><span class="w">           </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">donor_cc_id</span><span class="w">    </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">            </span><span class="n">enabled</span><span class="w">        </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="k">scope</span><span class="w">          </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;direct_personnel&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="n">recipient_cc_id</span><span class="w"> </span><span class="nb">TEXT</span>
<span class="w">        </span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: right;">#</th>
<th>name</th>
<th>type</th>
<th style="text-align: center;">notnull</th>
<th>default</th>
<th style="text-align: center;">pk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>rule_id</td>
<td>INTEGER</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>name</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>donor_cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">1</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>enabled</td>
<td>INTEGER</td>
<td style="text-align: center;">1</td>
<td>1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>scope</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td>'direct_personnel'</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>recipient_cc_id</td>
<td>TEXT</td>
<td style="text-align: center;">0</td>
<td></td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><a id="view-mo_last_price_current"></a></p>
<h2 id="view-mo_last_price_current">VIEW: mo_last_price_current<a class="headerlink" href="#view-mo_last_price_current" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">mo_last_price_current</span><span class="w"> </span><span class="k">AS</span>
<span class="w">    </span><span class="k">WITH</span><span class="w"> </span><span class="n">ranked</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">after_item_id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">datetime</span><span class="p">(</span><span class="n">loaded_at</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="n">rn</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">mo_prices_history</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">after_item_id</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">,</span><span class="w"> </span><span class="n">currency</span><span class="p">,</span><span class="w"> </span><span class="n">vendor</span><span class="p">,</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">loaded_at</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">ranked</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">rn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- mo_prices_history
- ranked</p>
<p><a id="view-opex_budget_effective"></a></p>
<h2 id="view-opex_budget_effective">VIEW: opex_budget_effective<a class="headerlink" href="#view-opex_budget_effective" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">opex_budget_effective</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">opex_budget</span>
<span class="w">            </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">plus</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">to_cc_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">to_elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">elem_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">bud_year</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">amount_delta</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">plus_amt</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">transfer_opex_items</span><span class="w"> </span><span class="n">i</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="n">transfer_batches</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">batch_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">batch_id</span>
<span class="w">            </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">to_cc_id</span><span class="p">,</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">to_elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">elem_id</span><span class="p">),</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">bud_year</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">minus</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">from_cc_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">bud_year</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">.</span><span class="n">amount_delta</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">minus_amt</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">transfer_opex_items</span><span class="w"> </span><span class="n">i</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="n">transfer_batches</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">batch_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">batch_id</span>
<span class="w">            </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">from_cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">bud_year</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">keys</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">base</span>
<span class="w">            </span><span class="k">UNION</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">plus</span>
<span class="w">            </span><span class="k">UNION</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">minus</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">bud_year</span><span class="p">,</span>
<span class="w">               </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">plus_amt</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">minus_amt</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount_effective</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">k</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">base</span><span class="w">  </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">elem_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">elem_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">bud_year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">bud_year</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">plus</span><span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">elem_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">elem_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">bud_year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">bud_year</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">minus</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">elem_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">elem_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">bud_year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">bud_year</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- opex_budget
- transfer_opex_items
- transfer_batches
- base
- plus
- minus
- keys</p>
<p><a id="view-ovh_tariffs_wide_compat"></a></p>
<h2 id="view-ovh_tariffs_wide_compat">VIEW: ovh_tariffs_wide_compat<a class="headerlink" href="#view-ovh_tariffs_wide_compat" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">ovh_tariffs_wide_compat</span><span class="w"> </span><span class="k">AS</span>
<span class="w">                </span><span class="k">SELECT</span>
<span class="w">                    </span><span class="n">overhead_group</span><span class="p">,</span>
<span class="w">                    </span><span class="k">year</span><span class="p">,</span>
<span class="w">                    </span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">cost_type</span><span class="o">=</span><span class="s1">&#39;scrap&#39;</span><span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="k">share</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">scrap_share</span><span class="p">,</span>
<span class="w">                    </span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">cost_type</span><span class="o">=</span><span class="s1">&#39;depr_opr&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">share</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">depr_opr_share</span><span class="p">,</span>
<span class="w">                    </span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">cost_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="w">      </span><span class="k">THEN</span><span class="w"> </span><span class="k">share</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">log_share</span><span class="p">,</span>
<span class="w">                    </span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">cost_type</span><span class="o">=</span><span class="s1">&#39;adm&#39;</span><span class="w">      </span><span class="k">THEN</span><span class="w"> </span><span class="k">share</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">adm_share</span>
<span class="w">                </span><span class="k">FROM</span><span class="w"> </span><span class="n">ovh_tariffs</span>
<span class="w">                </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">overhead_group</span><span class="p">,</span><span class="w"> </span><span class="k">year</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- ovh_tariffs</p>
<p><a id="view-personnel_yearly"></a></p>
<h2 id="view-personnel_yearly">VIEW: personnel_yearly<a class="headerlink" href="#view-personnel_yearly" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">personnel_yearly</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="k">TRIM</span><span class="p">(</span><span class="n">cc_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span>
<span class="w">               </span><span class="k">CAST</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">ym</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">bud_year</span><span class="p">,</span>
<span class="w">               </span><span class="k">AVG</span><span class="p">(</span><span class="n">headcount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">headcount_avg_year</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">personnel_monthly</span>
<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">TRIM</span><span class="p">(</span><span class="n">cc_id</span><span class="p">),</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">ym</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">)</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- personnel_monthly</p>
<p><a id="view-personnel_yearly_effective"></a></p>
<h2 id="view-personnel_yearly_effective">VIEW: personnel_yearly_effective<a class="headerlink" href="#view-personnel_yearly_effective" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">personnel_yearly_effective</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="k">TRIM</span><span class="p">(</span><span class="n">cc_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span>
<span class="w">                   </span><span class="k">CAST</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">ym</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">bud_year</span><span class="p">,</span>
<span class="w">                   </span><span class="k">AVG</span><span class="p">(</span><span class="n">headcount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">headcount_avg_year</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">personnel_monthly</span>
<span class="w">            </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">TRIM</span><span class="p">(</span><span class="n">cc_id</span><span class="p">),</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">ym</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">)</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">delta_in</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="k">TRIM</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">to_cc_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span>
<span class="w">                   </span><span class="k">CAST</span><span class="p">(</span><span class="k">REPLACE</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">bud_year</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">bud_year</span><span class="p">,</span>
<span class="w">                   </span><span class="k">SUM</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">headcount_delta</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">delta</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">transfer_personnel_items</span><span class="w"> </span><span class="n">i</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="n">transfer_batches</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">batch_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">batch_id</span>
<span class="w">            </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">TRIM</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">to_cc_id</span><span class="p">),</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="k">REPLACE</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">bud_year</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">)</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">delta_out</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="k">TRIM</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">from_cc_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span>
<span class="w">                   </span><span class="k">CAST</span><span class="p">(</span><span class="k">REPLACE</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">bud_year</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">bud_year</span><span class="p">,</span>
<span class="w">                   </span><span class="o">-</span><span class="k">SUM</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">headcount_delta</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">delta</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">transfer_personnel_items</span><span class="w"> </span><span class="n">i</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="n">transfer_batches</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">batch_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">batch_id</span>
<span class="w">            </span><span class="k">WHERE</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">from_cc_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="w">            </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">TRIM</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">from_cc_id</span><span class="p">),</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="k">REPLACE</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">bud_year</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">)</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">deltas</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">headcount_delta_year</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">                </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">delta_in</span>
<span class="w">                </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">                </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">delta_out</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">            </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">keys</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">base</span>
<span class="w">            </span><span class="k">UNION</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">deltas</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">cc_id</span><span class="p">,</span>
<span class="w">               </span><span class="n">k</span><span class="p">.</span><span class="n">bud_year</span><span class="p">,</span>
<span class="w">               </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">headcount_avg_year</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">headcount_delta_year</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                   </span><span class="k">AS</span><span class="w"> </span><span class="n">headcount_avg_year_effective</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">k</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">base</span><span class="w">   </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">bud_year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">bud_year</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">deltas</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">bud_year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">bud_year</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- personnel_monthly
- transfer_personnel_items
- transfer_batches
- delta_in
- delta_out
- base
- deltas
- keys</p>
<p><a id="view-v_alloc_lineage"></a></p>
<h2 id="view-v_alloc_lineage">VIEW: v_alloc_lineage<a class="headerlink" href="#view-v_alloc_lineage" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_alloc_lineage</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">lineage_links</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- lineage_links</p>
<p><a id="view-v_allocation_rule_effective"></a></p>
<h2 id="view-v_allocation_rule_effective">VIEW: v_allocation_rule_effective<a class="headerlink" href="#view-v_allocation_rule_effective" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_allocation_rule_effective</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="n">scoped</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">rule_set_id</span><span class="p">,</span>
<span class="w">                   </span><span class="n">rs</span><span class="p">.</span><span class="n">rule_id</span><span class="p">,</span>
<span class="w">                   </span><span class="n">rs</span><span class="p">.</span><span class="n">cc_node_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span>
<span class="w">                   </span><span class="n">rs</span><span class="p">.</span><span class="n">elem_node_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">elem_id</span><span class="p">,</span>
<span class="w">                   </span><span class="n">r</span><span class="p">.</span><span class="n">priority</span><span class="p">,</span>
<span class="w">                   </span><span class="n">r</span><span class="p">.</span><span class="n">driver_code</span><span class="p">,</span>
<span class="w">                   </span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="n">cc_node_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="n">elem_node_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">specificity</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">r</span>
<span class="w">            </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">rule_scope</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="n">rule_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">rule_id</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">ranked</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span>
<span class="w">                   </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span>
<span class="w">                     </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">rule_set_id</span><span class="p">,</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span>
<span class="w">                     </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">specificity</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">rule_id</span><span class="w"> </span><span class="k">ASC</span>
<span class="w">                   </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rn</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">scoped</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">rule_set_id</span><span class="p">,</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">rule_id</span><span class="p">,</span><span class="w"> </span><span class="n">driver_code</span><span class="p">,</span><span class="w"> </span><span class="n">priority</span><span class="p">,</span><span class="w"> </span><span class="n">specificity</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">ranked</span>
<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">rn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- rules
- rule_scope
- scoped
- ranked</p>
<p><a id="view-v_cogs_unit"></a></p>
<h2 id="view-v_cogs_unit">VIEW: v_cogs_unit<a class="headerlink" href="#view-v_cogs_unit" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_cogs_unit</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="n">alloc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">component_code</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">ca</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">cost_allocations</span><span class="w"> </span><span class="n">ca</span>
<span class="w">          </span><span class="k">JOIN</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">rule_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">rule_id</span>
<span class="w">          </span><span class="k">JOIN</span><span class="w"> </span><span class="n">active_alloc_sets</span><span class="w"> </span><span class="n">aas</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">aas</span><span class="p">.</span><span class="n">scenario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">scenario</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">aas</span><span class="p">.</span><span class="n">rule_set_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">rule_set_id</span>
<span class="w">          </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">component_code</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">mat</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">dv</span><span class="p">.</span><span class="k">period</span><span class="p">,</span>
<span class="w">                 </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">dv</span><span class="p">.</span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;BASE&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">scenario</span><span class="p">,</span>
<span class="w">                 </span><span class="n">dv</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;MATCOST&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">component_code</span><span class="p">,</span>
<span class="w">                 </span><span class="k">SUM</span><span class="p">(</span><span class="n">dv</span><span class="p">.</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">driver_values</span><span class="w"> </span><span class="n">dv</span>
<span class="w">          </span><span class="k">WHERE</span><span class="w"> </span><span class="n">dv</span><span class="p">.</span><span class="n">driver_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MATCOST&#39;</span>
<span class="w">          </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">dv</span><span class="p">.</span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">dv</span><span class="p">.</span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;BASE&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">dv</span><span class="p">.</span><span class="n">product_id</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">allc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">alloc</span>
<span class="w">          </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">mat</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">period</span><span class="p">,</span>
<span class="w">               </span><span class="n">a</span><span class="p">.</span><span class="n">scenario</span><span class="p">,</span>
<span class="w">               </span><span class="n">a</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span>
<span class="w">               </span><span class="n">a</span><span class="p">.</span><span class="n">component_code</span><span class="p">,</span>
<span class="w">               </span><span class="n">a</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span>
<span class="w">               </span><span class="n">b</span><span class="p">.</span><span class="n">qty</span><span class="p">,</span>
<span class="w">               </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">qty</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">qty</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount_per_unit</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">allc</span><span class="w"> </span><span class="n">a</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">v_prod_budget_active</span><span class="w"> </span><span class="n">b</span>
<span class="w">          </span><span class="k">ON</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">month_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">period</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- cost_allocations
- rules
- active_alloc_sets
- driver_values
- alloc
- mat
- allc
- v_prod_budget_active</p>
<p><a id="view-v_component_pools"></a></p>
<h2 id="view-v_component_pools">VIEW: v_component_pools<a class="headerlink" href="#view-v_component_pools" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_component_pools</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span><span class="p">,</span><span class="w"> </span><span class="n">amount_effective</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">opex_budget_effective</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">mapped</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">component_code</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">bud_year</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">amount_effective</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="n">b</span>
<span class="w">          </span><span class="k">JOIN</span><span class="w"> </span><span class="n">v_elem_component_map</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">elem_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">elem_id</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">months</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">),(</span><span class="mi">3</span><span class="p">),(</span><span class="mi">4</span><span class="p">),(</span><span class="mi">5</span><span class="p">),(</span><span class="mi">6</span><span class="p">),(</span><span class="mi">7</span><span class="p">),(</span><span class="mi">8</span><span class="p">),(</span><span class="mi">9</span><span class="p">),(</span><span class="mi">10</span><span class="p">),(</span><span class="mi">11</span><span class="p">),(</span><span class="mi">12</span><span class="p">)</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">expanded</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s1">&#39;%04d-%02d&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">period</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;PLAN&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">scenario</span><span class="p">,</span>
<span class="w">                 </span><span class="n">cc_id</span><span class="p">,</span>
<span class="w">                 </span><span class="n">component_code</span><span class="p">,</span>
<span class="w">                 </span><span class="n">amount_effective</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">12</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">mapped</span><span class="p">,</span><span class="w"> </span><span class="n">months</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">component_code</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">expanded</span>
<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">component_code</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- opex_budget_effective
- base
- v_elem_component_map
- mapped
- expanded</p>
<p><a id="view-v_driver_catalog"></a></p>
<h2 id="view-v_driver_catalog">VIEW: v_driver_catalog<a class="headerlink" href="#view-v_driver_catalog" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_driver_catalog</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">driver_code</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="p">,</span><span class="w"> </span><span class="n">granularity</span><span class="p">,</span><span class="w"> </span><span class="n">agg_rule</span><span class="p">,</span><span class="w"> </span><span class="n">source_policy</span><span class="p">,</span><span class="w"> </span><span class="n">is_ratio</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">drivers</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- drivers</p>
<p><a id="view-v_driver_values"></a></p>
<h2 id="view-v_driver_values">VIEW: v_driver_values<a class="headerlink" href="#view-v_driver_values" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_driver_values</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">set_id</span><span class="p">,</span><span class="w"> </span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="n">driver_code</span><span class="p">,</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="p">,</span><span class="w"> </span><span class="n">source_ref</span><span class="p">,</span><span class="w"> </span><span class="n">loaded_at</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">driver_values</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- driver_values</p>
<p><a id="view-v_elem_component_map"></a></p>
<h2 id="view-v_elem_component_map">VIEW: v_elem_component_map<a class="headerlink" href="#view-v_elem_component_map" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_elem_component_map</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span>
<span class="w">        </span><span class="n">roots</span><span class="p">(</span><span class="n">component_code</span><span class="p">,</span><span class="w"> </span><span class="n">root_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;LABOR_DIRECT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MFC_PRIM_1&#39;</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;OPR_DIRECT&#39;</span><span class="p">,</span><span class="w">   </span><span class="s1">&#39;MFC_PRIM_2&#39;</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;DEPR_DIRECT&#39;</span><span class="p">,</span><span class="w">  </span><span class="s1">&#39;MFC_PRIM_3&#39;</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">closure</span><span class="p">(</span><span class="n">component_code</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">component_code</span><span class="p">,</span><span class="w"> </span><span class="n">root_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">roots</span>
<span class="w">          </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">component_code</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">child_id</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="k">c</span>
<span class="w">          </span><span class="k">JOIN</span><span class="w"> </span><span class="n">elem_edges</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">elem_id</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">component_code</span><span class="p">,</span><span class="w"> </span><span class="n">elem_id</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">closure</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- roots
- closure
- elem_edges</p>
<p><a id="view-v_item_cg"></a></p>
<h2 id="view-v_item_cg">VIEW: v_item_cg<a class="headerlink" href="#view-v_item_cg" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_item_cg</span><span class="w"> </span><span class="k">AS</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">      </span><span class="n">i</span><span class="p">.</span><span class="n">item_id</span><span class="p">,</span>
<span class="w">      </span><span class="n">i</span><span class="p">.</span><span class="n">article</span><span class="p">,</span>
<span class="w">      </span><span class="n">i</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
<span class="w">      </span><span class="n">i</span><span class="p">.</span><span class="n">uom</span><span class="p">,</span>
<span class="w">      </span><span class="n">i</span><span class="p">.</span><span class="n">matl_group</span><span class="p">,</span>
<span class="w">      </span><span class="n">i</span><span class="p">.</span><span class="n">product_hierarchy</span><span class="p">,</span>
<span class="w">      </span><span class="n">cm</span><span class="p">.</span><span class="n">commodity_group</span><span class="p">,</span>
<span class="w">      </span><span class="n">cm</span><span class="p">.</span><span class="n">commodity_group_text</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">i</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">commodity_map</span><span class="w"> </span><span class="n">cm</span>
<span class="w">      </span><span class="k">ON</span><span class="w"> </span><span class="n">cm</span><span class="p">.</span><span class="n">matl_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="k">COALESCE</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">matl_group</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- items
- commodity_map</p>
<p><a id="view-v_labor_cost_unit_total"></a></p>
<h2 id="view-v_labor_cost_unit_total">VIEW: v_labor_cost_unit_total<a class="headerlink" href="#view-v_labor_cost_unit_total" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_labor_cost_unit_total</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">month_code</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">period</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">active_periods</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">alloc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">ca</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">cost_allocations</span><span class="w"> </span><span class="n">ca</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span>
<span class="w">          </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="k">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cfg</span><span class="p">.</span><span class="k">period</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">component_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LABOR_DIRECT&#39;</span>
<span class="w">          </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">product_id</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">qty</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">qty</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">v_prod_budget_active</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span>
<span class="w">          </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">month_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cfg</span><span class="p">.</span><span class="k">period</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span>
<span class="w">               </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">qty</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">qty</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cost_total</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">alloc</span><span class="w"> </span><span class="n">a</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">qty</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">product_id</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- active_periods
- cost_allocations
- v_prod_budget_active
- alloc
- qty</p>
<p><a id="view-v_opr_cost_unit_total"></a></p>
<h2 id="view-v_opr_cost_unit_total">VIEW: v_opr_cost_unit_total<a class="headerlink" href="#view-v_opr_cost_unit_total" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_opr_cost_unit_total</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">month_code</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">period</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">active_periods</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">alloc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">ca</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">cost_allocations</span><span class="w"> </span><span class="n">ca</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span>
<span class="w">          </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="k">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cfg</span><span class="p">.</span><span class="k">period</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">component_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;OPR_DIRECT&#39;</span>
<span class="w">          </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">product_id</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">qty</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">qty</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">v_prod_budget_active</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span>
<span class="w">          </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">month_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cfg</span><span class="p">.</span><span class="k">period</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span>
<span class="w">               </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">qty</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">qty</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cost_total</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">alloc</span><span class="w"> </span><span class="n">a</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">qty</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">product_id</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- active_periods
- cost_allocations
- v_prod_budget_active
- alloc
- qty</p>
<p><a id="view-v_ovh_cost_unit"></a></p>
<h2 id="view-v_ovh_cost_unit">VIEW: v_ovh_cost_unit<a class="headerlink" href="#view-v_ovh_cost_unit" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_ovh_cost_unit</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">depr_opr_cost</span><span class="p">,</span><span class="w"> </span><span class="n">log_cost</span><span class="p">,</span><span class="w"> </span><span class="n">adm_cost</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ovh_cost_unit</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- ovh_cost_unit</p>
<p><a id="view-v_ovh_flat_compat"></a></p>
<h2 id="view-v_ovh_flat_compat">VIEW: v_ovh_flat_compat<a class="headerlink" href="#view-v_ovh_flat_compat" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_ovh_flat_compat</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">SELECT</span>
<span class="w">          </span><span class="n">product_id</span><span class="p">,</span>
<span class="w">          </span><span class="n">node_product_id</span><span class="p">,</span>
<span class="w">          </span><span class="n">overhead_group</span><span class="p">,</span>
<span class="w">          </span><span class="n">driver_code</span><span class="w">           </span><span class="k">AS</span><span class="w"> </span><span class="n">base_kind</span><span class="p">,</span>
<span class="w">          </span><span class="n">driver_value_per_unit</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">base_value_per_unit</span><span class="p">,</span>
<span class="w">          </span><span class="n">driver_value_per_unit</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">mat_cost</span><span class="p">,</span>
<span class="w">          </span><span class="k">source</span><span class="p">,</span>
<span class="w">          </span><span class="k">year</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">ovh_flat</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- ovh_flat</p>
<p><a id="view-v_price_by_article"></a></p>
<h2 id="view-v_price_by_article">VIEW: v_price_by_article<a class="headerlink" href="#view-v_price_by_article" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_price_by_article</span><span class="w"> </span><span class="k">AS</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">      </span><span class="n">item_code</span><span class="p">,</span>
<span class="w">      </span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">scenario_code</span><span class="o">=</span><span class="s1">&#39;BG25&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">BG25</span><span class="p">,</span>
<span class="w">      </span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">scenario_code</span><span class="o">=</span><span class="s1">&#39;FC3&#39;</span><span class="w">  </span><span class="k">THEN</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FC3</span><span class="p">,</span>
<span class="w">      </span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">scenario_code</span><span class="o">=</span><span class="s1">&#39;BG26&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">BG26</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">v_price_by_scenario</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">currency</span><span class="o">=</span><span class="s1">&#39;RUB&#39;</span><span class="w">   </span><span class="c1">-- при необходимости можно убрать/параметризовать</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">item_code</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- v_price_by_scenario</p>
<p><a id="view-v_price_by_scenario"></a></p>
<h2 id="view-v_price_by_scenario-materials-pipeline">VIEW: v_price_by_scenario (materials pipeline)<a class="headerlink" href="#view-v_price_by_scenario-materials-pipeline" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_price_by_scenario</span><span class="w"> </span><span class="k">AS</span>
<span class="w">    </span><span class="k">WITH</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">item_code</span><span class="p">,</span><span class="w"> </span><span class="n">currency</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">rm_prices</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">      </span><span class="n">ps</span><span class="p">.</span><span class="n">scenario_code</span><span class="p">,</span>
<span class="w">      </span><span class="n">i</span><span class="p">.</span><span class="n">item_code</span><span class="p">,</span>
<span class="w">      </span><span class="n">i</span><span class="p">.</span><span class="n">currency</span><span class="p">,</span>
<span class="w">      </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">rp</span><span class="p">.</span><span class="n">price</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">rm_prices</span><span class="w"> </span><span class="n">rp</span>
<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">rp</span><span class="p">.</span><span class="n">item_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">item_code</span>
<span class="w">          </span><span class="k">AND</span><span class="w"> </span><span class="n">rp</span><span class="p">.</span><span class="n">currency</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">currency</span>
<span class="w">          </span><span class="k">AND</span><span class="w"> </span><span class="n">rp</span><span class="p">.</span><span class="n">effective_from</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="n">asof_date</span>
<span class="w">        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">rp</span><span class="p">.</span><span class="n">effective_from</span><span class="w"> </span><span class="k">DESC</span>
<span class="w">        </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">price</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">price_scenarios</span><span class="w"> </span><span class="n">ps</span>
<span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">i</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- rm_prices
- price_scenarios
- items</p>
<p><a id="view-v_prod_budget_active"></a></p>
<h2 id="view-v_prod_budget_active">VIEW: v_prod_budget_active<a class="headerlink" href="#view-v_prod_budget_active" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_prod_budget_active</span><span class="w"> </span><span class="k">AS</span>
<span class="w">    </span><span class="k">WITH</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">vol_scenario</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">active_scenarios</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="o">*</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">prod_budget</span><span class="w"> </span><span class="n">b</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">cfg</span><span class="p">.</span><span class="n">vol_scenario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">scenario</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- active_scenarios
- prod_budget
- cfg</p>
<p><a id="view-v_rate_parity"></a></p>
<h2 id="view-v_rate_parity">VIEW: v_rate_parity<a class="headerlink" href="#view-v_rate_parity" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_rate_parity</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span>
<span class="w">        </span><span class="c1">-- Effective rates per department (pick best/latest)</span>
<span class="w">        </span><span class="n">rates_ranked</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">department_code</span><span class="p">,</span><span class="w"> </span><span class="n">rate_per_hour</span><span class="p">,</span><span class="w"> </span><span class="n">currency</span><span class="p">,</span><span class="w"> </span><span class="n">bud_year</span><span class="p">,</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">calc_at</span><span class="p">,</span>
<span class="w">                 </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span>
<span class="w">                   </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">department_code</span>
<span class="w">                   </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">bud_year</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span>
<span class="w">                            </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">lower</span><span class="p">(</span><span class="k">COALESCE</span><span class="p">(</span><span class="k">source</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">=</span><span class="s1">&#39;calc&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="p">,</span>
<span class="w">                            </span><span class="n">datetime</span><span class="p">(</span><span class="k">COALESCE</span><span class="p">(</span><span class="n">calc_at</span><span class="p">,</span><span class="s1">&#39;1970-01-01&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">DESC</span>
<span class="w">                 </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rn</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">v_labor_rates_snapshot</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">effective_rates</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">department_code</span><span class="p">,</span><span class="w"> </span><span class="n">rate_per_hour</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">rates_ranked</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">rn</span><span class="o">=</span><span class="mi">1</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="c1">-- Hours per unit per product and department from routing_flat</span>
<span class="w">        </span><span class="n">hrs</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">department_code</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">hours_per_unit</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">hpu</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">routing_flat</span>
<span class="w">          </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">department_code</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="c1">-- Plan qty by period (PLAN scenario only for parity)</span>
<span class="w">        </span><span class="n">plan</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">month_code</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">qty</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">prod_budget</span>
<span class="w">          </span><span class="k">WHERE</span><span class="w"> </span><span class="n">scenario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;PLAN&#39;</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="c1">-- Compute routing×rate×qty per (period, cc, product)</span>
<span class="w">        </span><span class="n">rrq</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="k">period</span><span class="p">,</span>
<span class="w">                 </span><span class="n">m</span><span class="p">.</span><span class="n">cc_id</span><span class="p">,</span>
<span class="w">                 </span><span class="n">h</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span>
<span class="w">                 </span><span class="k">SUM</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">hpu</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">er</span><span class="p">.</span><span class="n">rate_per_hour</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">qty</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">hrs</span><span class="w"> </span><span class="n">h</span>
<span class="w">          </span><span class="k">JOIN</span><span class="w"> </span><span class="n">effective_rates</span><span class="w"> </span><span class="n">er</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">er</span><span class="p">.</span><span class="n">department_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">.</span><span class="n">department_code</span>
<span class="w">          </span><span class="k">JOIN</span><span class="w"> </span><span class="n">dep_cc_map</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">department_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">.</span><span class="n">department_code</span>
<span class="w">          </span><span class="k">JOIN</span><span class="w"> </span><span class="n">plan</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">.</span><span class="n">product_id</span>
<span class="w">          </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">.</span><span class="n">product_id</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">sum_rrq</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">rrq</span>
<span class="w">          </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">cc_id</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">pools</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">scenario</span><span class="p">,</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">component_code</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">v_component_pools</span>
<span class="w">          </span><span class="k">WHERE</span><span class="w"> </span><span class="n">component_code</span><span class="o">=</span><span class="s1">&#39;LABOR_DIRECT&#39;</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="k">period</span><span class="p">,</span>
<span class="w">               </span><span class="n">p</span><span class="p">.</span><span class="n">scenario</span><span class="p">,</span>
<span class="w">               </span><span class="n">p</span><span class="p">.</span><span class="n">cc_id</span><span class="p">,</span>
<span class="w">               </span><span class="n">p</span><span class="p">.</span><span class="n">component_code</span><span class="p">,</span>
<span class="w">               </span><span class="n">p</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">pool_from_opex</span><span class="p">,</span>
<span class="w">               </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sum_routing_rate_qty</span><span class="p">,</span>
<span class="w">               </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">delta</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">pools</span><span class="w"> </span><span class="n">p</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">sum_rrq</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="k">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="k">period</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">cc_id</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- v_labor_rates_snapshot
- rates_ranked
- routing_flat
- prod_budget
- hrs
- effective_rates
- dep_cc_map
- plan
- rrq
- v_component_pools
- pools
- sum_rrq</p>
<p><a id="view-v_recon_checks"></a></p>
<h2 id="view-v_recon_checks">VIEW: v_recon_checks<a class="headerlink" href="#view-v_recon_checks" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">v_recon_checks</span><span class="w"> </span><span class="k">AS</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="n">plan</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">qty</span><span class="p">,</span><span class="w"> </span><span class="n">month_code</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">v_prod_budget_active</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">pool</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">cc_id</span><span class="p">,</span>
<span class="w">                 </span><span class="n">p</span><span class="p">.</span><span class="n">month_code</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">period</span><span class="p">,</span>
<span class="w">                 </span><span class="k">SUM</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">cost_total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">qty</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">pool_amount</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">labor_cost_unit</span><span class="w"> </span><span class="n">l</span>
<span class="w">          </span><span class="k">JOIN</span><span class="w"> </span><span class="n">dep_cc_map</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">department_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">department_code</span>
<span class="w">          </span><span class="k">JOIN</span><span class="w"> </span><span class="n">plan</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">product_id</span>
<span class="w">          </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">month_code</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">alloc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">ca</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">allocated</span>
<span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">cost_allocations</span><span class="w"> </span><span class="n">ca</span>
<span class="w">          </span><span class="k">JOIN</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">rule_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">rule_id</span>
<span class="w">          </span><span class="k">JOIN</span><span class="w"> </span><span class="n">active_alloc_sets</span><span class="w"> </span><span class="n">aas</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">aas</span><span class="p">.</span><span class="n">scenario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">scenario</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">aas</span><span class="p">.</span><span class="n">rule_set_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">rule_set_id</span>
<span class="w">          </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">component_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LABOR_DIRECT&#39;</span>
<span class="w">          </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">ca</span><span class="p">.</span><span class="k">period</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">cc_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cc_id</span><span class="p">,</span>
<span class="w">               </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">period</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">period</span><span class="p">,</span>
<span class="w">               </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">pool_amount</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">pool_amount</span><span class="p">,</span>
<span class="w">               </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">allocated</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">allocated</span><span class="p">,</span>
<span class="w">               </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">allocated</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">pool_amount</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">delta</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="n">p</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">alloc</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="k">period</span>
<span class="w">        </span><span class="k">UNION</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">cc_id</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">period</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">pool_amount</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">allocated</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">allocated</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">delta</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">alloc</span><span class="w"> </span><span class="n">a</span>
<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">cc_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="k">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">period</span><span class="p">)</span>
</code></pre></div>
<p><strong>References (best-effort):</strong>
- v_prod_budget_active
- labor_cost_unit
- dep_cc_map
- plan
- cost_allocations
- rules
- active_alloc_sets
- pool
- alloc</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.9.0/dist/mermaid.min.js"></script>
      
        <script src="../../js/init_mermaid.js"></script>
      
    
  </body>
</html>