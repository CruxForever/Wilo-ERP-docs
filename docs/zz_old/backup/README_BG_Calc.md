# üìò Mini-ERP ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–ö–æ–º–ø–∞–∫—Ç–Ω–∞—è ERP-—Å–∏—Å—Ç–µ–º–∞ –Ω–∞ **Python + SQLite + Streamlit** –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏, –±—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö. –°–∫–≤–æ–∑–Ω–æ–π –ø—É—Ç—å: **–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ‚Üí –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí –∫–∞–ª—å–∫—É–ª—è—Ü–∏—è ‚Üí –º–∞—Å—Å–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç ‚Üí –±—é–¥–∂–µ—Ç/–æ—Ç—á—ë—Ç—ã**.&#x20;

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–ø–∞–ø–∫–∏/–º–æ–¥—É–ª–∏)

* `ui/` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Streamlit: —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ `app_streamlit.py`, —ç–∫—Ä–∞–Ω—ã –∫–∞–ª—å–∫—É–ª—è—Ü–∏–∏, –∑–∞–≥—Ä—É–∑–∫–∏, –º–∞—Å—Å–æ–≤—ã—Ö –ø—Ä–æ–≥–æ–Ω–æ–≤, –±—é–¥–∂–µ—Ç–æ–≤.&#x20;
* `calc/` ‚Äî –¥–æ–º–µ–Ω–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã: –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ä–µ–≤—å–µ–≤, –∫–∞–ª—å–∫—É–ª—è—Ü–∏–∏, –±—é–¥–∂–µ—Ç, –ø–∞–π–ø–ª–∞–π–Ω.&#x20;
* `db/` ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —Ñ—É–Ω–∫—Ü–∏–∏ `ensure_*` –¥–ª—è —Å—Ö–µ–º –ë–î.&#x20;
* `loaders/` ‚Äî –∑–∞–≥—Ä—É–∑—á–∏–∫–∏ XLSX/TXT (–º–∞—Ç–µ—Ä–∏–∞–ª—ã, —Å—Ç–∞–≤–∫–∏, —Ü–µ–Ω—ã, –±—é–¥–∂–µ—Ç).&#x20;
* `config/` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É—Ç–µ–π/–∫–æ–¥–∏—Ä–æ–≤–æ–∫.&#x20;

---

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (ETL ‚Üí —Ä–∞—Å—á—ë—Ç—ã ‚Üí –æ—Ç—á—ë—Ç—ã)

1. **–ó–∞–≥—Ä—É–∑–∫–∞** –≤–Ω–µ—à–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü ‚Üí SQLite (items, BOM, —Ü–µ–Ω—ã, —Å—Ç–∞–≤–∫–∏ –∏ —Ç.–¥.).
2. **–ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è**: —Å—Ç—Ä–æ—è—Ç—Å—è `routing_tree/routing_flat`, —Ç—Ä—É–¥/–∞–º–æ—Ä—Ç/–û–ü–†/overhead, scrap.
3. **–ö–∞–ª—å–∫—É–ª—è—Ü–∏—è**: —Å–±–æ—Ä —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ –∏–∑–¥–µ–ª–∏—é –≤ –µ–¥–∏–Ω—É—é —Ç–∞–±–ª–∏—Ü—É.
4. **–ë—é–¥–∂–µ—Ç**: –∑–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–Ω–∞ –≤—ã–ø—É—Å–∫–∞, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å—é, —ç–∫—Å–ø–æ—Ä—Ç –≤ Excel.&#x20;

–ö–ª—é—á–µ–≤—ã–µ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: `materialize_*`, `compute_item_cost_unified`, `build_unified_(detailed|compact)_table`, `run_full_pipeline`, `export_budget_to_excel`.&#x20;

---

## üóÑÔ∏è –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö (–æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –ø–æ–ª—è)

–ù–∏–∂–µ ‚Äî –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–ª–æ–Ω–æ–∫ (—Ñ–∞–∫—Ç, –±–µ–∑ –ª–∏—à–Ω–µ–π —Ç–µ–æ—Ä–∏–∏). –°—Å—ã–ª–∫–∏ ‚Äî –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞—Å—á—ë—Ç–∞—Ö.

### 1) –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∏ –≤—Ö–æ–¥–Ω—ã–µ

#### `items`

* `item_id` (TEXT, PK) ‚Äî **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–¥** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–∞—Å—á—ë—Ç–∞—Ö –∏ —Å–≤—è–∑—è—Ö).
* `article` (TEXT, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π) ‚Äî **–≤–Ω–µ—à–Ω–∏–π –∞—Ä—Ç–∏–∫—É–ª** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ UI –∏ Excel-–∑–∞–≥—Ä—É–∑–∫–∞—Ö).
* `name` (TEXT) ‚Äî –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ.
* `uom` (TEXT) ‚Äî –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è (–®–¢/–ö–ì/‚Ä¶).
* `is_produced` (INT 0/1) ‚Äî —Ñ–ª–∞–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–π –ø–æ–∑–∏—Ü–∏–∏.
* `routing_group` (TEXT, –æ–ø—Ü.) ‚Äî –≥—Ä—É–ø–ø–∞ –º–∞—Ä—à—Ä—É—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∏–∑–¥–µ–ª–∏—è (–¥–ª—è –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏/–∫–æ–Ω—Ç—Ä–æ–ª—è).
* `ovh_group_code` (TEXT, –æ–ø—Ü.) ‚Äî –∫–æ–¥ overhead-–≥—Ä—É–ø–ø—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –∏–∑–¥–µ–ª–∏—è (–ê00/‚Ä¶).

> –í –∫–∞–ª—å–∫—É–ª—è—Ü–∏–∏ **–∞—Ä—Ç–∏–∫—É–ª** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `article`, –∞ –≤—Å–µ —Å–≤—è–∑–∏ –∏–¥—É—Ç –ø–æ **`item_id`**.

#### `bom`

* `parent_item_id` (TEXT) ‚Äî —É–∑–µ–ª –≤—ã—à–µ.
* `component_item_id` (TEXT) ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.
* `level` (INT) ‚Äî –≥–ª—É–±–∏–Ω–∞ (1 ‚Äî –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç).
* `path` (TEXT) ‚Äî –ø—É—Ç—å –æ—Ç –∫–æ—Ä–Ω—è: `FG ‚Ä∫ ‚Ä¶ ‚Ä∫ parent_id ‚Ä∫ component_id` (—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è).
* `qty_per_unit` (REAL) ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É FG.

> –í —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º –æ—Ç—á—ë—Ç–µ –¥–ª—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å—Ç—Ä–æ–∏—Ç—Å—è `context`:
>
> * –Ω–∞ `level=1` ‚Äî –∞—Ä—Ç–∏–∫—É–ª FG,
> * –Ω–∞ `level‚â•2` ‚Äî –∞—Ä—Ç–∏–∫—É–ª **—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ** —É–∑–ª–∞ –∏–∑ `path`.

#### `rm_prices` ‚Äî **–∏—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤**

* `item_code` (TEXT) ‚Äî = `items.item_id`.
* `article` (TEXT) ‚Äî –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è.
* `uom` (TEXT)
* `price` (REAL) ‚Äî —Ü–µ–Ω–∞ –∑–∞ UOM.
* `currency` (TEXT, –Ω–∞–ø—Ä. `RUB`).
* `source` (TEXT) ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∑–∞–≥—Ä—É–∑–∫–∏.
* `loaded_at` (TEXT, `YYYY-MM-DD HH:MM:SS`) ‚Äî —à—Ç–∞–º–ø –∑–∞–≥—Ä—É–∑–∫–∏.

**–ö–∞–∫ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Ü–µ–Ω–∞:** CTE `last_price` –±–µ—Ä—ë—Ç **–ø–æ—Å–ª–µ–¥–Ω—é—é –ø–æ `loaded_at`** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ `item_code` (—Å–º. SQL-—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –≤ —Ä–∞—Å—á—ë—Ç–∞—Ö).&#x20;

> ‚ö†Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è **–∏—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω**: –¥–æ–ø—É—Å—Ç–∏–º–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –Ω–∞ `item_code/currency`.
> –í –æ—Ç—á—ë—Ç–∞—Ö –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Å–∞–º–∞—è —Å–≤–µ–∂–∞—è**.

#### `routing_flat`

* `product_id` (TEXT) ‚Äî `item_id` –∏–∑–¥–µ–ª–∏—è.
* `routing_name` (TEXT) ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏/–º–∞—Ä—à—Ä—É—Ç–∞.
* `department_code` (TEXT) ‚Äî —Ü–µ—Ö/—É—á–∞—Å—Ç–æ–∫.
* `hours_per_unit` (REAL) ‚Äî —Ç—Ä—É–¥–æ—ë–º–∫–æ—Å—Ç—å –Ω–∞ 1 –µ–¥–∏–Ω–∏—Ü—É FG (–∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç—Å—è).&#x20;

#### `labor_rates_snapshot`

* `department_code` (TEXT)
* `rate_per_hour` (REAL)
* `currency` (TEXT)

> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–º–Ω–æ–∂–µ–Ω–∏—è `hours_per_unit` ‚Üí **—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä—è–º–æ–≥–æ —Ç—Ä—É–¥–∞**.

### 2) –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ / –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ

#### `labor_cost_unit`, `depr_cost_unit`, `opr_cost_unit`

* `product_id` (TEXT)
* `department_code` (TEXT)
* `hours_total` (REAL)
* `rate_per_hour` (REAL)
* `cost_total` (REAL)

> –≠—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º ‚Äî –æ—Ç—Ç—É–¥–∞ –Ω–∞–ø—Ä—è–º—É—é –±–µ—Ä—ë—Ç—Å—è **–ø—Ä—è–º–æ–π —Ç—Ä—É–¥**, **–∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è (–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ)** –∏ **–û–ü–† (—Ü–µ—Ö–æ–≤—ã–µ)** –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞.&#x20;

#### `scrap_cost_unit`

* `product_id` (TEXT)
* `overhead_group_code` (TEXT)
* `scrap_cost` (REAL)

#### `ovh_tree`, `ovh_flat`

* –î–µ—Ä–µ–≤–æ –∏ –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ overhead-–≥—Ä—É–ø–ø –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π.

#### `ovh_tariffs`

* `overhead_group` (TEXT)
* `year` (INT)
* *–ø–æ–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤* –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞ **–ê–º–æ—Ä—Ç –û–ü–†**, **–õ–æ–≥–∏—Å—Ç–∏–∫—É**, **–£–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–µ** (–Ω–∞–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–µ—Ç–æ–¥–∏–∫–∏).

#### `ovh_cost_unit`

* `product_id` (TEXT)
* `overhead_group_code` (TEXT)
* `depr_opr_cost` (REAL)
* `log_cost` (REAL)
* `adm_cost` (REAL)

### 3) –ë—é–¥–∂–µ—Ç

#### `prod_budget`

* `product_id` (TEXT, = `items.item_id`)
* `month_code` (TEXT `YYYY-MM`)
* `qty` (REAL) ‚Äî –ø–ª–∞–Ω –≤—ã–ø—É—Å–∫–∞.&#x20;

---

## üßÆ –ö–∞–ª—å–∫—É–ª—è—Ü–∏–∏ (—á—Ç–æ –∏ –∫–∞–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è)

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ—Ç—á—ë—Ç (`build_unified_detailed_table`)

–ï–¥–∏–Ω–∞—è —Ü–µ–ª–µ–≤–∞—è —Å—Ö–µ–º–∞:
`section, article, level, context, name, qty, rate, amount, department_code, overhead_group_code, routing_name`.&#x20;

* **–ú–∞—Ç–µ—Ä–∏–∞–ª—ã**:

  * —Å—Ç—Ä–æ–∫–∏ –∏–∑ `bom` (–≤—Å–µ —É—Ä–æ–≤–Ω–∏), `article` –±–µ—Ä—ë–º –∏–∑ `items.article`, —Ü–µ–Ω–∞ ‚Äî `rm_prices.last_price`, `amount = qty * rate`;
  * `context`: FG –¥–ª—è `level=1`, **—Ä–æ–¥–∏—Ç–µ–ª—å** (–ø–æ `path`) –¥–ª—è `level‚â•2`;
  * –¥–æ–±–∞–≤–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ `path` –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è (`‚Ä∫`, `‚Üí`, `/`, `\` ‚Üí `>`).
* **–ü—Ä—è–º–æ–π —Ç—Ä—É–¥ / –ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è (–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ) / –û–ü–† (—Ü–µ—Ö–æ–≤—ã–µ)**:
  `context = department_code`, `article = routing_name` (–¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Ä–∞–∑—Ä–µ–∑–æ–≤ –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º).
* **–û–•–† (–ª–æ–≥–∏—Å—Ç–∏–∫–∞/—É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–µ) –∏ –ê–º–æ—Ä—Ç –û–ü–†, –ë—Ä–∞–∫**:
  `context = overhead_group_code`, `article = overhead_group_code`.

### –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –æ—Ç—á—ë—Ç (`build_unified_compact_table`)

* –°—É–º–º—ã –ø–æ —Å–µ–∫—Ü–∏—è–º + **TOTAL** –∏ –¥–æ–ª–∏ —Å–µ–∫—Ü–∏–π, % –æ—Ç Total.&#x20;
* –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –∏–∑ BOM —Å —Ü–µ–Ω–æ–π `last_price` –ø–æ `item_id`.&#x20;

### –ò—Ç–æ–≥–æ–≤—ã–µ —Å—É–º–º—ã

* `GRAND TOTAL = –ú–∞—Ç–µ—Ä–∏–∞–ª—ã + –ü—Ä—è–º–æ–π —Ç—Ä—É–¥ + –ê–º–æ—Ä—Ç (–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ) + –û–ü–† (—Ü–µ—Ö–æ–≤—ã–µ) + –ê–º–æ—Ä—Ç –û–ü–† + –û–•–† –ª–æ–≥–∏—Å—Ç–∏–∫–∞ + –û–•–† —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–µ + –ë—Ä–∞–∫`.&#x20;

### –ü–æ—Ä—è–¥–æ–∫ –≤—ã–≤–æ–¥–∞ —Å–µ–∫—Ü–∏–π (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞)

1. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
2. –ë—Ä–∞–∫
3. –ó–ü (–ø—Ä—è–º–æ–π —Ç—Ä—É–¥)
4. –û–ü–† (—Ü–µ—Ö–æ–≤—ã–µ)
5. –ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è (–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ)
6. –ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è (–∞–¥–º–∏–Ω)
7. –û–•–† (–ª–æ–≥–∏—Å—Ç–∏–∫–∞)
8. –û–•–† (—É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–µ)

---

## üì• –ó–∞–≥—Ä—É–∑—á–∏–∫–∏ (Excel)

### 1) –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ overhead-–≥—Ä—É–ø–ø (`items`)

**–§–æ—Ä–º–∞—Ç XLSX**: –∫–æ–ª–æ–Ω–∫–∏ `item_id`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `routing_group`, `ovh_group_code`.
–ü–æ–≤–µ–¥–µ–Ω–∏–µ: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞–∑–ª–∏—á–∏–π (old vs new), –ø—Ä–∏–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –ø–æ–ª—è.

### 2) –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ü–µ–Ω (`rm_prices`)

**–§–æ—Ä–º–∞—Ç XLSX**:

* `Material` ‚Äî **–∞—Ä—Ç–∏–∫—É–ª** (—Ç–µ–∫—Å—Ç/—á–∏—Å–ª–æ ‚Üí –ø—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ —Ç–µ–∫—Å—Ç—É, —Å –æ–±—Ä–µ–∑–∫–æ–π —Å—É—Ñ—Ñ–∏–∫—Å–∞ `.0`).
* `Material description` ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è.
* `STD 2026` ‚Äî –Ω–æ–≤–∞—è —Ü–µ–Ω–∞ –≤ —Ä—É–±–ª—è—Ö.

–ü–æ–≤–µ–¥–µ–Ω–∏–µ:

* `article` ‚Üí –∏—â–µ–º `items.item_id` (–ø–æ–ª—É—á–∞–µ–º `item_code` –∏ `uom`).
* –ø–∏—à–µ–º **–Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É** –≤ `rm_prices` —Å `source` –∏ `loaded_at` (–∏—Å—Ç–æ—Ä–∏—è).
* –æ—Ç—á—ë—Ç—ã –±–µ—Ä—É—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–µ–Ω—É –ø–æ `item_code` ‚Üí `MAX(loaded_at)`.&#x20;

---

## üß™ –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö (quality)

–≠–∫—Ä–∞–Ω —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–∞–º –∏ –≤—ã–≥—Ä—É–∑–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ **Excel** (–ø–æ –∫–∞–∂–¥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞/–∫–Ω–æ–ø–∫–∞):

* `items`: –ø—É—Å—Ç—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (`article/name/uom`)
* `items`: –¥—É–±–ª–∏ –∞—Ä—Ç–∏–∫—É–ª–æ–≤
* **–ü—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–µ** (`is_produced=1`) –±–µ–∑ `routing_group`/`ovh_group_code`
* **–ù–µ–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–µ** (`is_produced=0`) —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ `routing_group/ovh_group_code`
* `BOM`: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ `items`
* `routing_flat`: –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã –±–µ–∑ —Å—Ç–∞–≤–∫–∏ –≤ `labor_rates_snapshot`
* `BOM`: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑ —Ü–µ–Ω—ã –≤ `rm_prices` (–ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–µ)
* `OVH`: –≥—Ä—É–ø–ø—ã –±–µ–∑ —Ç–∞—Ä–∏—Ñ–∞ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π/–ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥
* **–ë—é–¥–∂–µ—Ç**: –≤ `prod_budget` –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –ø–æ–∑–∏—Ü–∏–∏ —Å `is_produced=0`

---

## üß≠ –ü—Ä–∞–≤–∏–ª–∞ –∏ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏

* **ID vs –ê—Ä—Ç–∏–∫—É–ª**: –≤–æ –≤—Å–µ—Ö —Å–≤—è–∑—è—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º **`item_id`**, –≤ UI –∏ Excel ‚Äî **`article`**.
* **–ü—É—Ç—å BOM**: –≤ –ë–î —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ —Ü–µ–ø–æ—á–∫–∞ `item_id`, –≤ UI –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ `path_article` (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∞—Ä—Ç–∏–∫—É–ª–∞).
* **–¶–µ–Ω—ã –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤**: `rm_prices` —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é; ¬´–∞–∫—Ç—É–∞–ª—å–Ω–∞—è¬ª ‚Äî –∑–∞–ø–∏—Å—å —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º `loaded_at`.
* **–°—Ç–∞–≤–∫–∏ —Ç—Ä—É–¥–∞**: –±–µ—Ä—É—Ç—Å—è –∏–∑ `labor_rates_snapshot` –ø–æ `department_code`.
* **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–µ–∫—Ü–∏–π**: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (—Å–º. —Å–ø–∏—Å–æ–∫ –≤—ã—à–µ).
* **–ï–¥–∏–Ω–∏—Ü—ã**: –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ —á–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ —á–∏—Å–ª–∞–º –∏ –æ–∫—Ä—É–≥–ª—è—é—Ç—Å—è (`qty` ‚Äî –¥–æ 6, `amount` ‚Äî –¥–æ 2).

---

## üìà –ë—é–¥–∂–µ—Ç

* –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–Ω–∞ `prod_budget` (–∞—Ä—Ç–∏–∫—É–ª ‚Üí `item_id`, –º–µ—Å—è—Ü—ã `YYYY-MM`).
* –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–∞–¥—Ä–æ–≤ **Total** –∏ **–ø–æ –º–µ—Å—è—Ü–∞–º**; —ç–∫—Å–ø–æ—Ä—Ç –≤ Excel.&#x20;

---

## üß© –ì–¥–µ –∏—Å–∫–∞—Ç—å –∫–æ–¥

* –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã/–∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥: `calc/item_cost.py` (–µ–¥–∏–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏, –ø–æ–¥–∏—Ç–æ–≥–∏, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ). &#x20;
* –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã: `calc/materialize.py` (–¥–µ—Ä–µ–≤—å—è, —Ç—Ä—É–¥, –∞–º–æ—Ä—Ç, –û–ü–†, OVH, scrap).&#x20;
* –ü–∞–π–ø–ª–∞–π–Ω –∏ –±—é–¥–∂–µ—Ç: `calc/pipeline.py`, `calc/budget.py`.&#x20;
* –ó–∞–≥—Ä—É–∑—á–∏–∫–∏: `loaders/*` –∏ —ç–∫—Ä–∞–Ω—ã `ui/views_loader.py`.&#x20;

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

* [ ] –ó–∞–≥—Ä—É–∂–µ–Ω—ã `items`, `bom`, `rm_prices`, `labor_rates_snapshot`
* [ ] –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è `routing_*`, `*_cost_unit`, `ovh_*`
* [ ] –ü—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (–≤—Å–µ —á–µ–∫–±–æ–∫—Å—ã ¬´0 –ø—Ä–æ–±–ª–µ–º¬ª –∏–ª–∏ –ø—Ä–∏–Ω—è—Ç—ã —Ä–µ—à–µ–Ω–∏—è)
* [ ] –í –∫–∞–ª—å–∫—É–ª—è—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã **–ú–∞—Ç–µ—Ä–∏–∞–ª—ã** (—Ü–µ–Ω—ã –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è)
* [ ] –ë—é–¥–∂–µ—Ç —Å–æ–±—Ä–∞–Ω –∏ –≤—ã–≥—Ä—É–∂–µ–Ω –≤ Excel
