# ADR-0003 — Allocation Rules Engine

**Status:** Proposed  
**Date:** 2025-10-06

## Context
Необходимо поддержать несколько наборов правил распределения затрат (по часам, по мат.стоимости, по CC, доля для зданий/сооружений), с версионированием, трассировкой и возможностью «делить статью на несколько».

## Decision
Создаём **движок правил** на основе декларативного YAML-DSL + библиотека драйверов:
- Таблицы: `rule_sets`, `rules`, `rule_filters`, `rule_splits`, `rule_params`.  
- Выполнение: SQL-пайплайн + Python-хелперы `driver_lib`.  
- Трассировка: `lineage_links` (src→dst с rule_id).

## Consequences
**Плюсы:** гибкость, читаемость, контроль версий, воспроизводимость.  
**Минусы:** усложнение ETL.  
**Митигация:** ограниченный DSL v1, только проверенные драйверы, реестры тестов.
